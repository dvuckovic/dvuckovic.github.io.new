<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Simple internet checker | Dusan’s Space</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&amp;family=Merriweather+Sans:ital,wght@0,600;1,600&amp;family=Merriweather:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&amp;display=swap">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-SJD4XMS3R4"></script>
    <script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-SJD4XMS3R4');</script>
    <link rel="alternate" type="application/rss+xml" href="https://dvuckovic.com/rss.xml" title="Dusan’s Space RSS Feed">
    <meta name="description" content="Automatic router restart in case you get offline">
    <meta property="article:published_time" content="2011-05-05T00:00:00.000Z">
    <meta property="article:modified_time" content="2021-06-20T12:02:17.000Z">
    <meta property="og:site_name" content="Dusan’s Space">
    <meta property="og:title" content="Simple internet checker">
    <meta property="og:description" content="Automatic router restart in case you get offline">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/2011/05/05/simple-internet-checker/">
    <meta property="og:image" content="https://cdn.dvuckovic.com/posts/internet-checker_header.jpg">
    <meta name="twitter:title" content="Simple internet checker">
    <meta name="twitter:description" content="Automatic router restart in case you get offline">
    <meta name="twitter:url" content="/2011/05/05/simple-internet-checker/">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://cdn.dvuckovic.com/posts/internet-checker_header.jpg">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="post, internet, dos, shell, script">
    <meta property="article:tag" content="post">
    <meta name="theme-color" content="#ff7700">
    <link rel="preload" href="/assets/css/0.styles.e0e4cea7.css" as="style"><link rel="preload" href="/assets/js/app.7a75f1fe.js" as="script"><link rel="preload" href="/assets/js/19.1346b3bf.js" as="script"><link rel="preload" href="/assets/js/12.e1236284.js" as="script"><link rel="preload" href="/assets/js/140.e742b946.js" as="script"><link rel="prefetch" href="/assets/js/1.47b44be3.js"><link rel="prefetch" href="/assets/js/10.9100961c.js"><link rel="prefetch" href="/assets/js/100.75b666b5.js"><link rel="prefetch" href="/assets/js/101.b3bbfd39.js"><link rel="prefetch" href="/assets/js/102.cbe66969.js"><link rel="prefetch" href="/assets/js/103.b08a0869.js"><link rel="prefetch" href="/assets/js/104.b4824db2.js"><link rel="prefetch" href="/assets/js/105.e8e6da25.js"><link rel="prefetch" href="/assets/js/106.df067897.js"><link rel="prefetch" href="/assets/js/107.4f834df4.js"><link rel="prefetch" href="/assets/js/108.b9fa77db.js"><link rel="prefetch" href="/assets/js/109.39b66c07.js"><link rel="prefetch" href="/assets/js/11.2d771e9d.js"><link rel="prefetch" href="/assets/js/110.a72e9012.js"><link rel="prefetch" href="/assets/js/111.8f8d0d52.js"><link rel="prefetch" href="/assets/js/112.483c0499.js"><link rel="prefetch" href="/assets/js/113.53a1b0ec.js"><link rel="prefetch" href="/assets/js/114.994e6fc6.js"><link rel="prefetch" href="/assets/js/115.d019b3b3.js"><link rel="prefetch" href="/assets/js/116.7da14914.js"><link rel="prefetch" href="/assets/js/117.354f5fc2.js"><link rel="prefetch" href="/assets/js/118.4bd88bb2.js"><link rel="prefetch" href="/assets/js/119.5bae7b8d.js"><link rel="prefetch" href="/assets/js/120.e909e859.js"><link rel="prefetch" href="/assets/js/121.cc4c1bb4.js"><link rel="prefetch" href="/assets/js/122.e935a102.js"><link rel="prefetch" href="/assets/js/123.bd515f08.js"><link rel="prefetch" href="/assets/js/124.f307495d.js"><link rel="prefetch" href="/assets/js/125.494e6420.js"><link rel="prefetch" href="/assets/js/126.cf0aa04c.js"><link rel="prefetch" href="/assets/js/127.127e1e9d.js"><link rel="prefetch" href="/assets/js/128.a13966fc.js"><link rel="prefetch" href="/assets/js/129.fb9a5055.js"><link rel="prefetch" href="/assets/js/13.4a201018.js"><link rel="prefetch" href="/assets/js/130.0bab81cb.js"><link rel="prefetch" href="/assets/js/131.8d311242.js"><link rel="prefetch" href="/assets/js/132.f67d9af5.js"><link rel="prefetch" href="/assets/js/133.0901673e.js"><link rel="prefetch" href="/assets/js/134.4fd746f6.js"><link rel="prefetch" href="/assets/js/135.48d3c5be.js"><link rel="prefetch" href="/assets/js/136.87d5eb67.js"><link rel="prefetch" href="/assets/js/137.6552c782.js"><link rel="prefetch" href="/assets/js/138.eb4cae8e.js"><link rel="prefetch" href="/assets/js/139.f7100a2e.js"><link rel="prefetch" href="/assets/js/14.1e9f23d3.js"><link rel="prefetch" href="/assets/js/141.9fec0628.js"><link rel="prefetch" href="/assets/js/142.0c3c7ddb.js"><link rel="prefetch" href="/assets/js/143.04245474.js"><link rel="prefetch" href="/assets/js/144.3abcb36c.js"><link rel="prefetch" href="/assets/js/15.ff2cd584.js"><link rel="prefetch" href="/assets/js/16.f4971c4d.js"><link rel="prefetch" href="/assets/js/17.075cedfd.js"><link rel="prefetch" href="/assets/js/18.d792f2ec.js"><link rel="prefetch" href="/assets/js/2.c692d64a.js"><link rel="prefetch" href="/assets/js/20.15be60dc.js"><link rel="prefetch" href="/assets/js/21.c1a7bfa3.js"><link rel="prefetch" href="/assets/js/22.943f67ea.js"><link rel="prefetch" href="/assets/js/23.f431f4d6.js"><link rel="prefetch" href="/assets/js/24.339c4804.js"><link rel="prefetch" href="/assets/js/25.c67844dd.js"><link rel="prefetch" href="/assets/js/26.a52a97e9.js"><link rel="prefetch" href="/assets/js/27.dfbd74dc.js"><link rel="prefetch" href="/assets/js/28.de140592.js"><link rel="prefetch" href="/assets/js/29.de0191f6.js"><link rel="prefetch" href="/assets/js/3.22cfc250.js"><link rel="prefetch" href="/assets/js/30.5ec4efe2.js"><link rel="prefetch" href="/assets/js/31.3b982379.js"><link rel="prefetch" href="/assets/js/32.c6814f82.js"><link rel="prefetch" href="/assets/js/33.e7bb6f69.js"><link rel="prefetch" href="/assets/js/34.9dc51e9f.js"><link rel="prefetch" href="/assets/js/35.113cecc0.js"><link rel="prefetch" href="/assets/js/36.3b4c1524.js"><link rel="prefetch" href="/assets/js/37.514cbc8e.js"><link rel="prefetch" href="/assets/js/38.6c805e13.js"><link rel="prefetch" href="/assets/js/39.6a747384.js"><link rel="prefetch" href="/assets/js/40.0c1f511e.js"><link rel="prefetch" href="/assets/js/41.8232996f.js"><link rel="prefetch" href="/assets/js/42.9cc151a3.js"><link rel="prefetch" href="/assets/js/43.ac76176b.js"><link rel="prefetch" href="/assets/js/44.5c73c2ae.js"><link rel="prefetch" href="/assets/js/45.8aa2357a.js"><link rel="prefetch" href="/assets/js/46.d2a10c93.js"><link rel="prefetch" href="/assets/js/47.92d84b19.js"><link rel="prefetch" href="/assets/js/48.5fd68038.js"><link rel="prefetch" href="/assets/js/49.975e7623.js"><link rel="prefetch" href="/assets/js/50.2a526f11.js"><link rel="prefetch" href="/assets/js/51.0b39be9e.js"><link rel="prefetch" href="/assets/js/52.1569c0e2.js"><link rel="prefetch" href="/assets/js/53.357bb5b0.js"><link rel="prefetch" href="/assets/js/54.d2f0ee28.js"><link rel="prefetch" href="/assets/js/55.5a6dce91.js"><link rel="prefetch" href="/assets/js/56.443679dc.js"><link rel="prefetch" href="/assets/js/57.591116bf.js"><link rel="prefetch" href="/assets/js/58.6079e6ab.js"><link rel="prefetch" href="/assets/js/59.10b56410.js"><link rel="prefetch" href="/assets/js/60.2042eab2.js"><link rel="prefetch" href="/assets/js/61.f3d5a99f.js"><link rel="prefetch" href="/assets/js/62.ca93a9e8.js"><link rel="prefetch" href="/assets/js/63.5f72d7fe.js"><link rel="prefetch" href="/assets/js/64.02655094.js"><link rel="prefetch" href="/assets/js/65.ed2d18c4.js"><link rel="prefetch" href="/assets/js/66.04ff7e44.js"><link rel="prefetch" href="/assets/js/67.95f7e57e.js"><link rel="prefetch" href="/assets/js/68.92b2a93f.js"><link rel="prefetch" href="/assets/js/69.7be4992d.js"><link rel="prefetch" href="/assets/js/70.3f9ad26a.js"><link rel="prefetch" href="/assets/js/71.d981d4cf.js"><link rel="prefetch" href="/assets/js/72.6468e54e.js"><link rel="prefetch" href="/assets/js/73.511ae092.js"><link rel="prefetch" href="/assets/js/74.228329eb.js"><link rel="prefetch" href="/assets/js/75.0d8b8262.js"><link rel="prefetch" href="/assets/js/76.e871abb9.js"><link rel="prefetch" href="/assets/js/77.1c43e23d.js"><link rel="prefetch" href="/assets/js/78.a97e55eb.js"><link rel="prefetch" href="/assets/js/79.d3714341.js"><link rel="prefetch" href="/assets/js/80.f5e67788.js"><link rel="prefetch" href="/assets/js/81.424fac9a.js"><link rel="prefetch" href="/assets/js/82.896a47aa.js"><link rel="prefetch" href="/assets/js/83.b23ff087.js"><link rel="prefetch" href="/assets/js/84.8cd76b1e.js"><link rel="prefetch" href="/assets/js/85.74ffdeee.js"><link rel="prefetch" href="/assets/js/86.4e98c5e0.js"><link rel="prefetch" href="/assets/js/87.5842ad2a.js"><link rel="prefetch" href="/assets/js/88.ea409a24.js"><link rel="prefetch" href="/assets/js/89.8e3cfb1e.js"><link rel="prefetch" href="/assets/js/9.73534068.js"><link rel="prefetch" href="/assets/js/90.544ae8d5.js"><link rel="prefetch" href="/assets/js/91.b2bf80c8.js"><link rel="prefetch" href="/assets/js/92.9e37cf18.js"><link rel="prefetch" href="/assets/js/93.d2624e22.js"><link rel="prefetch" href="/assets/js/94.70594964.js"><link rel="prefetch" href="/assets/js/95.fdc05f59.js"><link rel="prefetch" href="/assets/js/96.5a1bf07d.js"><link rel="prefetch" href="/assets/js/97.fcf77cd3.js"><link rel="prefetch" href="/assets/js/98.53ab7c12.js"><link rel="prefetch" href="/assets/js/99.d488142a.js"><link rel="prefetch" href="/assets/js/getag-map.64e16d15.js"><link rel="prefetch" href="/assets/js/vendors~bootstrap.6d48da59.js"><link rel="prefetch" href="/assets/js/vendors~masonry-layout.135896b3.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.9a9ceefc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e0e4cea7.css"><style data-vue-ssr-id="data-v-3ea4e60c_0">.bi{fill:currentColor;width:1em;height:1em;font-size:1em;margin-bottom:.125em;vertical-align:middle}.bi--variant-success{color:var(--bs-success)}.bi--variant-warning{color:var(--bs-warning)}.bi--variant-danger{color:var(--bs-danger)}.bi--variant-info{color:var(--bs-info)}.bi--variant-primary{color:var(--bs-primary)}.bi--variant-secondary{color:var(--bs-secondary)}.bi--variant-dark{color:var(--bs-dark)}.bi--variant-light{color:var(--bs-light)}.bi--size-sm{font-size:.75em}.bi--size-md{font-size:1.25rem}.bi--size-lg{font-size:1.33333333rem}.bi--size-2x{font-size:2rem}.bi--size-3x{font-size:3rem}.bi--size-4x{font-size:4rem}.bi--size-5x{font-size:5rem}.bi--animation-cylon{animation:bi-animation-cylon .75s ease-in-out infinite alternate}.bi--animation-cylon-vertical{animation:bi-animation-cylon-vertical .75s ease-in-out infinite alternate}.bi--animation-fade{animation:bi-animation-fade .75s ease-in-out infinite alternate}.bi--animation-spin{animation:bi-animation-spin 2s linear infinite normal}.bi--animation-spin-reverse{animation:bi-animation-spin 2s linear infinite reverse}.bi--animation-spin-pulse{animation:bi-animation-spin 1s steps(8) infinite normal}.bi--animation-spin-reverse-pulse{animation:bi-animation-spin 1s steps(8) infinite reverse}.bi--animation-throb{animation:bi-animation-throb .75s ease-in-out infinite alternate}@keyframes bi-animation-cylon{0%{transform:translateX(-25%)}100%{transform:translateX(25%)}}@keyframes bi-animation-cylon-vertical{0%{transform:translateY(25%)}100%{transform:translateY(-25%)}}@keyframes bi-animation-fade{0%{opacity:.1}100%{opacity:1}}@keyframes bi-animation-spin{0%{transform:rotate(0)}100%{transform:rotate(359deg)}}@keyframes bi-animation-throb{0%{opacity:.5;transform:scale(.5)}100%{opacity:1;transform:scale(1)}}
</style>
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="d-flex flex-column min-vh-100"><header class="container-fluid position-relative Header"><nav class="navbar navbar-expand-sm navbar-dark"><div class="container-lg"><a href="/" class="NavLink navbar-brand"><img src="https://cdn.dvuckovic.com/images/avatar.png" alt="Dusan’s Space" title="Dusan’s Space" height="32" class="d-block position-relative"></a> <button type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler"><svg class="bi bi--size-lg"><g transform="" transform-origin="center"><use xlink:href="/assets/img/bootstrap-icons.982100e4.svg#list"></use></g></svg></button> <div id="navbar" class="collapse navbar-collapse"><ul role="menu" class="navbar-nav align-items-end me-auto text-uppercase"><li role="menuitem" class="position-relative nav-item"><a href="/tag/post/" class="NavLink nav-link">
                            Posts
                        </a></li><li role="menuitem" class="position-relative nav-item"><a href="/tag/project/" class="NavLink nav-link">
                            Projects
                        </a></li><li role="menuitem" class="position-relative nav-item"><a href="/tag/photo/" class="NavLink nav-link">
                            Photos
                        </a></li><li role="menuitem" class="position-relative nav-item"><a href="/tag/panorama/" class="NavLink nav-link">
                            Panoramas
                        </a></li></ul> <ul class="navbar-nav justify-content-end align-items-end Header__Nav__Right"><li class="nav-item"><div class="search-box pe-4"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></li> <li class="nav-item"><a href="/rss.xml" title="Feed" class="Feed pe-4"><svg class="bi bi--size-md"><g transform="" transform-origin="center"><use xlink:href="/assets/img/bootstrap-icons.982100e4.svg#rss-fill"></use></g></svg></a></li> <li class="nav-item"><a href="https://instagram.com/dvuckovic82" target="_blank" rel="noopener noreferrer" title="Instagram" class="NavLink NavLink--External position-relative d-block pe-4"><svg class="bi bi--size-md"><g transform="" transform-origin="center"><use xlink:href="/assets/img/bootstrap-icons.982100e4.svg#instagram"></use></g></svg></a></li><li class="nav-item"><a href="https://github.com/dvuckovic" target="_blank" rel="noopener noreferrer" title="GitHub" class="NavLink NavLink--External position-relative d-block"><svg class="bi bi--size-md"><g transform="" transform-origin="center"><use xlink:href="/assets/img/bootstrap-icons.982100e4.svg#github"></use></g></svg></a></li></ul></div></div></nav> <!----></header> <article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="container-lg px-3 Post GlobalLayout"><div class="row justify-content-center"><header id="header" class="col-md-9 Post__Header"><ul itemprop="keywords" class="d-flex flex-row mb-2 list-unstyled Post__Meta Post__Meta--Tags"><li class="text-uppercase PostTag"><a href="/tag/post" class="me-3"><span>
            post
        </span></a></li><li class="text-uppercase PostTag"><a href="/tag/internet" class="me-3"><span>
            internet
        </span></a></li><li class="text-uppercase PostTag"><a href="/tag/dos" class="me-3"><span>
            dos
        </span></a></li><li class="text-uppercase PostTag"><a href="/tag/shell" class="me-3"><span>
            shell
        </span></a></li><li class="text-uppercase PostTag"><a href="/tag/script" class="me-3"><span>
            script
        </span></a></li></ul> <h1 itemprop="name headline" class="Post__Title">
                Simple internet checker
            </h1> <p itemprop="description" class="mt-4 mb-4 Post__Summary">
                Automatic router restart in case you get offline
            </p> <footer><!----> <div class="text-uppercase Post__Meta Post__Meta--Date"><time itemprop="datePublished" datetime="2011-05-05T00:00:00.000Z">
                        2011-05-05
                    </time> <span class="mx-2">
                            •
                        </span>
                        15 minutes
                    </div></footer></header></div> <div class="row"><figure class="col Post__FullImage"><img src="https://cdn.dvuckovic.com/posts/internet-checker_header.jpg" alt="Simple internet checker" sizes="(max-width: 800px) 400px, (max-width: 1170px) 1170px, 2000px" class="rounded w-100"></figure></div> <div class="row justify-content-center"><section itemprop="articleBody" class="col-md-9"><div class="Post__Content content__default"><p>In my corporate workplace we have a dedicated ADSL line for the Windows® mail server. As all connections go it’s a little buggy, so every now and then ADSL router locks up, mails stop flowing and the only thing that helps is the manual reboot of the router. Since this seems to happen only on the weekends and other non-working hours (Murphy’s Law?), the need arose for an automated solution to this problem.</p> <p>My initial idea was for a small command line program that pings a server and takes an action if the ping fails. This is relatively easy to do, and since there are Scheduled Tasks available on the Windows® system, you can set this program to auto execute on some reasonable time interval.</p> <p>Since this is only going to be used on Windows®, I decided that MS-DOS® Batch script should do the trick. Ping is already available in shell access (ping), and you can find plethora of different programs to help you make a normal HTTP request from the command line (e.g. wget, curl). Almost all routers nowadays have web-based administration interface, so, in theory, you can always simulate user rebooting the router by sending appropriate requests. Granted, some of these are more complex than others and may require sending a variable or two along with the request. One thing that always helped me when trying to figure out the correct sequence of events in these circumstances was Mozilla Firefox®.</p> <p>Firefox® has several mind blowing add-ons/plugins, one of them being <a href="http://livehttpheaders.mozdev.org/" target="_blank" rel="noopener noreferrer">Live HTTP Headers<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Using it while rebooting the router in browser you can inspect all the requests interface makes in order to accomplish this: all the correct URIs, variables, etc. Also, it may help by looking at the source code of the page with the Reboot button: note the action in the FORM containing the button, almost always it is the correct URL of the page that process the request.</p> <p>So, let’s take a look at <a href="https://cdn.dvuckovic.com/downloads/internet-checker.bat" target="_blank" rel="noopener noreferrer">the script itself<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>First, we turn off any unnecessary &quot;echoes&quot; of our commands (old friend of all DOS batch scripters):</p> <div class="language-batch extra-class"><pre class="language-batch"><code><span class="token operator">@</span><span class="token command"><span class="token keyword">echo</span> off</span>
</code></pre></div><p>Then we ping the most reliable server which we can find (I use Google, but that <a href="http://techcrunch.com/2009/05/14/googles-gets-its-own-fail-whale/" target="_blank" rel="noopener noreferrer">might not be good idea<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>):</p> <div class="language-batch extra-class"><pre class="language-batch"><code><span class="token command"><span class="token keyword">ping</span> <span class="token parameter attr-name">-n</span> <span class="token number">1</span> www.google.com|find <span class="token parameter attr-name">/i</span> <span class="token string">&quot;Received = 1&quot;</span> &gt; NUL</span>
</code></pre></div><p>Note the &quot;pipe&quot; (<code>|</code>) operator which pipes the output of the first command to the input of the second one. ping first sends a single ICMP packet to www.google.com. <code>find</code> command then searches the output of ping for &quot;Received = 1&quot; string, and compares the result. For IFTHEN clause we will be using a check of the ErrorLevel, which gets raised if an error has occurred:</p> <div class="language-batch extra-class"><pre class="language-batch"><code><span class="token command"><span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token keyword">ErrorLevel</span> <span class="token number">1</span></span> <span class="token punctuation">(</span><span class="token command"><span class="token keyword">goto</span> <span class="token label property">:WORKS</span></span><span class="token punctuation">)</span> <span class="token command"><span class="token keyword">else</span></span> <span class="token punctuation">(</span><span class="token command"><span class="token keyword">goto</span> <span class="token label property">:DOESNTWORK</span></span><span class="token punctuation">)</span>
</code></pre></div><p><code>goto</code> commands use labels to redirect the flow of the script. So if no error was raised during the last compare (e.g. ICMP packet was successfully returned), script will execute all code under the :WORKS label:</p> <div class="language-batch extra-class"><pre class="language-batch"><code><span class="token command"><span class="token keyword">eventcreate</span> <span class="token parameter attr-name">/l</span> System <span class="token parameter attr-name">/t</span> INFORMATION <span class="token parameter attr-name">/so</span> internet-checker <span class="token parameter attr-name">/id</span> <span class="token number">200</span> <span class="token parameter attr-name">/d</span> <span class="token string">&quot;Internet OK, proceeding normally...&quot;</span></span>
<span class="token command"><span class="token keyword">goto</span> end</span>
</code></pre></div><p>Here we will log the check as successful to the Windows Event Log, in order to keep track when the check has occurred. <code>eventcreate</code> command helps us achieve that, by logging our event to the System log, as a type of Information, with an ID of 200 (any ID from 1 through 1000 will do).</p> <p>In case there was a problem with a <code>ping</code> packet, and error was raised, code under the second label would be executed:</p> <div class="language-batch extra-class"><pre class="language-batch"><code><span class="token label property">:DOESNTWORK</span>
<span class="token command"><span class="token keyword">eventcreate</span> <span class="token parameter attr-name">/l</span> System <span class="token parameter attr-name">/t</span> ERROR <span class="token parameter attr-name">/so</span> internet-checker <span class="token parameter attr-name">/id</span> <span class="token number">500</span> <span class="token parameter attr-name">/d</span> <span class="token string">&quot;Internet down, rebooting router...&quot;</span></span>
<span class="token comment">:: START CURL EXECUTION</span>
<span class="token comment">:: FOR WEBSTAR CABLE MODEM</span>
<span class="token comment">:: curl -d &quot;ResetToFactory=3&quot; -d &quot;RestoreFactoryYes=1&quot; http://192.168.100.1/goform/reset</span>
<span class="token comment">:: FOR TPLINK CABLE ROUTER</span>
<span class="token comment">:: curl -D - -s -u &quot;user:pass&quot; &quot;http://192.168.1.1/userRpm/SysRebootRpm.htm?Reboot=Reboot&quot;</span>
<span class="token comment">:: FOR TPLINK ADSL ROUTER</span>
<span class="token command"><span class="token keyword">curl</span> <span class="token parameter attr-name">-D</span> - <span class="token parameter attr-name">-s</span> <span class="token parameter attr-name">-u</span> <span class="token string">&quot;user:pass&quot;</span> <span class="token string">&quot;http://192.168.0.3/rebootinfo.cgi&quot;</span></span>
<span class="token comment">:: END CURL EXECUTION</span>
</code></pre></div><p>First, we log an Event, but a different one, of type Error, and with an ID of 500. Then we turn to the curl program and execute a request which will result in router reboot. As you can see there are numerous options for this, and these are just some cases I stumbled upon. I’d liked to keep them all in case I would need to refactor this script for a different use (I will just uncomment them by removing <code>::</code>). Take a closer look at the last curl command: switch <code>-u</code> sends a &quot;user:pass&quot; combination, because <code>curl</code> must be able to make proper HTTP authorization in order to use the script.</p> <p>There are some caveats in this whole DOS batch approach:</p> <ul><li>storing user/pass combination plain like this in a text script is a little bit sensitive, but it beats the hell out of need to manually enter the password when prompted (not a particularly efficient for an automated solution).</li> <li><code>eventcreate</code> command produces an output which confirms that an event was logged, and this is difficult to avoid (there is no <code>/quiet</code> switch here).</li> <li>also, a brief command prompt window would appear if the program was called from GUI.</li></ul> <p>So, how to address these issues? Well, there is a small program which can &quot;compile&quot; your DOS batch script to an .EXE file, with a few added bonuses. The program name is <a href="http://www.f2ko.de/programs.php?lang=en&amp;pid=b2e" target="_blank" rel="noopener noreferrer">Bat To Exe Converter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and it’s freeware.</p> <p>Compiled programs are difficult to decompose, so user/pass combination for your router will probably be safe. There is also an option to encrypt the .EXE file, which is even safer. Then, there is an option to make the new application &quot;invisible&quot;, e.g. there would be no pop up window, no output, nothing! That’s 3 of 3.</p> <p><img src="https://cdn.dvuckovic.com/posts/internet-checker-bat2exe.jpg#nozoom" alt="Bat To Exe Converter"></p> <p>Now let’s go over bonuses:</p> <ul><li>there is an option to include all external programs and extract them on runtime, along with deleting the files when done with them (here you can include curl and its DLLs.</li> <li>you can add an icon to the .EXE file and make all thing much more serious 😃</li> <li>programs allows you to embed .EXE manifest, too</li></ul> <p>I was sold when I tried all this, and a final .EXE file was made. I will not be sharing it, because of the obvious reasons (I doubt someone else has this same user/pass combination on their router, on the same address nevertheless). So feel free to adapt the .BAT script and compile it.</p> <p>In order to schedule the task for repetitive invocation, you can use following command:</p> <div class="language-batch extra-class"><pre class="language-batch"><code><span class="token command"><span class="token keyword">C</span><span class="token label property">:\&gt;schtasks</span> <span class="token parameter attr-name">/create</span> <span class="token parameter attr-name">/sc</span> minute <span class="token parameter attr-name">/mo</span> <span class="token number">30</span> <span class="token parameter attr-name">/tn</span> internet-checker <span class="token parameter attr-name">/tr</span> <span class="token string">&quot;c:\internet-checker.exe&quot;</span></span>
</code></pre></div><p>It will create a task that runs our app on every 30 minutes (be sure to supply correct path!). Too much, too little? Adjust where necessary.</p> <p>That’s it! Just be sure to check Event Log now and then to be sure you’re running the script (<code>eventvwr</code> opens up dedicated MMC window).</p> <p><img src="https://cdn.dvuckovic.com/posts/internet-checker-dos.jpg#nozoom" alt="Bat To Exe Converter"></p></div></section></div> <div class="row"><section itemprop="articleBody" class="col"><div class="Post__Content content__wide"></div></section></div> <!----></article> <footer class="container-fluid flex-grow-1 Footer"><div class="container-lg my-3"><div class="row align-items-center"><div class="col-lg-3 order-3 order-lg-1"><ul role="menu" class="d-flex flex-row justify-content-center justify-content-lg-start m-0 list-unstyled"><li role="menuitem" class="Footer__Nav__Item"><a href="/" class="NavLink">
                            © 2021 Dusan Vuckovic
                        </a></li></ul></div> <div class="col-lg-6 order-2 mt-1 mb-2 mb-lg-0 Footer__Center"><ul role="menu" class="d-flex flex-wrap justify-content-center m-0 list-unstyled"><li role="menuitem" class="mb-1 me-1 Footer__Nav__Item"><a href="https://vuepress.vuejs.org" target="_blank" class="NavLink NavLink--External"><img src="https://img.shields.io/badge/powered_by-VuePress-3eaf7c?logo=Vue.js" alt="Powered by VuePress"></a></li><li role="menuitem" class="mb-1 me-1 Footer__Nav__Item"><a href="https://www.cloudflare.com" target="_blank" class="NavLink NavLink--External"><img src="https://img.shields.io/badge/secured_by-Cloudflare-f38020?logo=cloudflare" alt="Secured by Cloudflare"></a></li><li role="menuitem" class="mb-1 me-1 Footer__Nav__Item"><a href="http://www.wtfpl.net" target="_blank" class="NavLink NavLink--External"><img src="https://img.shields.io/badge/license-WTFPL-white" alt="Licensed as WTFPL"></a></li></ul></div> <div class="col-lg-3 order-1 order-lg-3 mb-2 mb-lg-0"><ul role="menu" class="d-flex flex-row justify-content-center justify-content-lg-end m-0 list-unstyled"><li role="menuitem" class="Footer__Nav__Item"><a href="#email-modal" data-bs-toggle="modal" class="NavLink NavLink--External">
                            Email
                        </a></li><li role="menuitem" class="Footer__Nav__Item"><a href="/privacy-policy.html" class="NavLink">
                            Privacy
                        </a></li><li role="menuitem" class="Footer__Nav__Item"><a href="https://github.com/dvuckovic" target="_blank" class="NavLink NavLink--External">
                            Github
                        </a></li></ul></div></div></div></footer> <div id="email-modal" tabindex="-1" aria-hidden="true" class="modal fade"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h2 class="modal-title">Hey there!</h2></div> <div class="modal-body"><p>The best way to get in touch with me directly is to drop me an email.</p>
<p>My email address is my <strong>given name</strong> at this website.</p>
<p><em>If you want to send me a secure message, you can get <a href="https://cdn.dvuckovic.com/downloads/dvuckovic.crt" class="NavLink NavLink--PublicKey" download>my S/MIME certificate</a>.</em></p><p><small><em>Or, if you prefer PGP, get <a href="https://cdn.dvuckovic.com/downloads/dvuckovic.pub" class="NavLink NavLink--PublicKey" download>my public key</a>.</em></small></p></div> <div class="modal-footer"><button type="button" data-bs-dismiss="modal" class="btn btn-primary">Got it!</button></div></div></div></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7a75f1fe.js" defer></script><script src="/assets/js/19.1346b3bf.js" defer></script><script src="/assets/js/12.e1236284.js" defer></script><script src="/assets/js/140.e742b946.js" defer></script>
  </body>
</html>
