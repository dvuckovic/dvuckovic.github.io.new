<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Setup S/MIME Encryption for Gmail | Dusan’s Space</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&amp;family=Merriweather+Sans:ital,wght@0,600;1,600&amp;family=Merriweather:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&amp;display=swap">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-SJD4XMS3R4"></script>
    <script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-SJD4XMS3R4');</script>
    <link rel="alternate" type="application/rss+xml" href="https://dvuckovic.com/rss.xml" title="Dusan’s Space RSS Feed">
    <meta name="description" content="We got nothing to hide, but why not?">
    <meta property="article:published_time" content="2020-12-22T00:00:00.000Z">
    <meta property="article:modified_time" content="2021-06-20T12:02:17.000Z">
    <meta property="og:site_name" content="Dusan’s Space">
    <meta property="og:title" content="Setup S/MIME Encryption for Gmail">
    <meta property="og:description" content="We got nothing to hide, but why not?">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/2020/12/22/setup-smime-encryption-gmail/">
    <meta property="og:image" content="https://cdn.dvuckovic.com/posts/smime-certificates.jpg">
    <meta name="twitter:title" content="Setup S/MIME Encryption for Gmail">
    <meta name="twitter:description" content="We got nothing to hide, but why not?">
    <meta name="twitter:url" content="/2020/12/22/setup-smime-encryption-gmail/">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://cdn.dvuckovic.com/posts/smime-certificates.jpg">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="post, encryption, gmail, thunderbird">
    <meta property="article:tag" content="post">
    <meta name="theme-color" content="#ff7700">
    <link rel="preload" href="/assets/css/0.styles.e0e4cea7.css" as="style"><link rel="preload" href="/assets/js/app.7a75f1fe.js" as="script"><link rel="preload" href="/assets/js/19.1346b3bf.js" as="script"><link rel="preload" href="/assets/js/12.e1236284.js" as="script"><link rel="preload" href="/assets/js/139.f7100a2e.js" as="script"><link rel="prefetch" href="/assets/js/1.47b44be3.js"><link rel="prefetch" href="/assets/js/10.9100961c.js"><link rel="prefetch" href="/assets/js/100.75b666b5.js"><link rel="prefetch" href="/assets/js/101.b3bbfd39.js"><link rel="prefetch" href="/assets/js/102.cbe66969.js"><link rel="prefetch" href="/assets/js/103.b08a0869.js"><link rel="prefetch" href="/assets/js/104.b4824db2.js"><link rel="prefetch" href="/assets/js/105.e8e6da25.js"><link rel="prefetch" href="/assets/js/106.df067897.js"><link rel="prefetch" href="/assets/js/107.4f834df4.js"><link rel="prefetch" href="/assets/js/108.b9fa77db.js"><link rel="prefetch" href="/assets/js/109.39b66c07.js"><link rel="prefetch" href="/assets/js/11.2d771e9d.js"><link rel="prefetch" href="/assets/js/110.a72e9012.js"><link rel="prefetch" href="/assets/js/111.8f8d0d52.js"><link rel="prefetch" href="/assets/js/112.483c0499.js"><link rel="prefetch" href="/assets/js/113.53a1b0ec.js"><link rel="prefetch" href="/assets/js/114.994e6fc6.js"><link rel="prefetch" href="/assets/js/115.d019b3b3.js"><link rel="prefetch" href="/assets/js/116.7da14914.js"><link rel="prefetch" href="/assets/js/117.354f5fc2.js"><link rel="prefetch" href="/assets/js/118.4bd88bb2.js"><link rel="prefetch" href="/assets/js/119.5bae7b8d.js"><link rel="prefetch" href="/assets/js/120.e909e859.js"><link rel="prefetch" href="/assets/js/121.cc4c1bb4.js"><link rel="prefetch" href="/assets/js/122.e935a102.js"><link rel="prefetch" href="/assets/js/123.bd515f08.js"><link rel="prefetch" href="/assets/js/124.f307495d.js"><link rel="prefetch" href="/assets/js/125.494e6420.js"><link rel="prefetch" href="/assets/js/126.cf0aa04c.js"><link rel="prefetch" href="/assets/js/127.127e1e9d.js"><link rel="prefetch" href="/assets/js/128.a13966fc.js"><link rel="prefetch" href="/assets/js/129.fb9a5055.js"><link rel="prefetch" href="/assets/js/13.4a201018.js"><link rel="prefetch" href="/assets/js/130.0bab81cb.js"><link rel="prefetch" href="/assets/js/131.8d311242.js"><link rel="prefetch" href="/assets/js/132.f67d9af5.js"><link rel="prefetch" href="/assets/js/133.0901673e.js"><link rel="prefetch" href="/assets/js/134.4fd746f6.js"><link rel="prefetch" href="/assets/js/135.48d3c5be.js"><link rel="prefetch" href="/assets/js/136.87d5eb67.js"><link rel="prefetch" href="/assets/js/137.6552c782.js"><link rel="prefetch" href="/assets/js/138.eb4cae8e.js"><link rel="prefetch" href="/assets/js/14.1e9f23d3.js"><link rel="prefetch" href="/assets/js/140.e742b946.js"><link rel="prefetch" href="/assets/js/141.9fec0628.js"><link rel="prefetch" href="/assets/js/142.0c3c7ddb.js"><link rel="prefetch" href="/assets/js/143.04245474.js"><link rel="prefetch" href="/assets/js/144.3abcb36c.js"><link rel="prefetch" href="/assets/js/15.ff2cd584.js"><link rel="prefetch" href="/assets/js/16.f4971c4d.js"><link rel="prefetch" href="/assets/js/17.075cedfd.js"><link rel="prefetch" href="/assets/js/18.d792f2ec.js"><link rel="prefetch" href="/assets/js/2.c692d64a.js"><link rel="prefetch" href="/assets/js/20.15be60dc.js"><link rel="prefetch" href="/assets/js/21.c1a7bfa3.js"><link rel="prefetch" href="/assets/js/22.943f67ea.js"><link rel="prefetch" href="/assets/js/23.f431f4d6.js"><link rel="prefetch" href="/assets/js/24.339c4804.js"><link rel="prefetch" href="/assets/js/25.c67844dd.js"><link rel="prefetch" href="/assets/js/26.a52a97e9.js"><link rel="prefetch" href="/assets/js/27.dfbd74dc.js"><link rel="prefetch" href="/assets/js/28.de140592.js"><link rel="prefetch" href="/assets/js/29.de0191f6.js"><link rel="prefetch" href="/assets/js/3.22cfc250.js"><link rel="prefetch" href="/assets/js/30.5ec4efe2.js"><link rel="prefetch" href="/assets/js/31.3b982379.js"><link rel="prefetch" href="/assets/js/32.c6814f82.js"><link rel="prefetch" href="/assets/js/33.e7bb6f69.js"><link rel="prefetch" href="/assets/js/34.9dc51e9f.js"><link rel="prefetch" href="/assets/js/35.113cecc0.js"><link rel="prefetch" href="/assets/js/36.3b4c1524.js"><link rel="prefetch" href="/assets/js/37.514cbc8e.js"><link rel="prefetch" href="/assets/js/38.6c805e13.js"><link rel="prefetch" href="/assets/js/39.6a747384.js"><link rel="prefetch" href="/assets/js/40.0c1f511e.js"><link rel="prefetch" href="/assets/js/41.8232996f.js"><link rel="prefetch" href="/assets/js/42.9cc151a3.js"><link rel="prefetch" href="/assets/js/43.ac76176b.js"><link rel="prefetch" href="/assets/js/44.5c73c2ae.js"><link rel="prefetch" href="/assets/js/45.8aa2357a.js"><link rel="prefetch" href="/assets/js/46.d2a10c93.js"><link rel="prefetch" href="/assets/js/47.92d84b19.js"><link rel="prefetch" href="/assets/js/48.5fd68038.js"><link rel="prefetch" href="/assets/js/49.975e7623.js"><link rel="prefetch" href="/assets/js/50.2a526f11.js"><link rel="prefetch" href="/assets/js/51.0b39be9e.js"><link rel="prefetch" href="/assets/js/52.1569c0e2.js"><link rel="prefetch" href="/assets/js/53.357bb5b0.js"><link rel="prefetch" href="/assets/js/54.d2f0ee28.js"><link rel="prefetch" href="/assets/js/55.5a6dce91.js"><link rel="prefetch" href="/assets/js/56.443679dc.js"><link rel="prefetch" href="/assets/js/57.591116bf.js"><link rel="prefetch" href="/assets/js/58.6079e6ab.js"><link rel="prefetch" href="/assets/js/59.10b56410.js"><link rel="prefetch" href="/assets/js/60.2042eab2.js"><link rel="prefetch" href="/assets/js/61.f3d5a99f.js"><link rel="prefetch" href="/assets/js/62.ca93a9e8.js"><link rel="prefetch" href="/assets/js/63.5f72d7fe.js"><link rel="prefetch" href="/assets/js/64.02655094.js"><link rel="prefetch" href="/assets/js/65.ed2d18c4.js"><link rel="prefetch" href="/assets/js/66.04ff7e44.js"><link rel="prefetch" href="/assets/js/67.95f7e57e.js"><link rel="prefetch" href="/assets/js/68.92b2a93f.js"><link rel="prefetch" href="/assets/js/69.7be4992d.js"><link rel="prefetch" href="/assets/js/70.3f9ad26a.js"><link rel="prefetch" href="/assets/js/71.d981d4cf.js"><link rel="prefetch" href="/assets/js/72.6468e54e.js"><link rel="prefetch" href="/assets/js/73.511ae092.js"><link rel="prefetch" href="/assets/js/74.228329eb.js"><link rel="prefetch" href="/assets/js/75.0d8b8262.js"><link rel="prefetch" href="/assets/js/76.e871abb9.js"><link rel="prefetch" href="/assets/js/77.1c43e23d.js"><link rel="prefetch" href="/assets/js/78.a97e55eb.js"><link rel="prefetch" href="/assets/js/79.d3714341.js"><link rel="prefetch" href="/assets/js/80.f5e67788.js"><link rel="prefetch" href="/assets/js/81.424fac9a.js"><link rel="prefetch" href="/assets/js/82.896a47aa.js"><link rel="prefetch" href="/assets/js/83.b23ff087.js"><link rel="prefetch" href="/assets/js/84.8cd76b1e.js"><link rel="prefetch" href="/assets/js/85.74ffdeee.js"><link rel="prefetch" href="/assets/js/86.4e98c5e0.js"><link rel="prefetch" href="/assets/js/87.5842ad2a.js"><link rel="prefetch" href="/assets/js/88.ea409a24.js"><link rel="prefetch" href="/assets/js/89.8e3cfb1e.js"><link rel="prefetch" href="/assets/js/9.73534068.js"><link rel="prefetch" href="/assets/js/90.544ae8d5.js"><link rel="prefetch" href="/assets/js/91.b2bf80c8.js"><link rel="prefetch" href="/assets/js/92.9e37cf18.js"><link rel="prefetch" href="/assets/js/93.d2624e22.js"><link rel="prefetch" href="/assets/js/94.70594964.js"><link rel="prefetch" href="/assets/js/95.fdc05f59.js"><link rel="prefetch" href="/assets/js/96.5a1bf07d.js"><link rel="prefetch" href="/assets/js/97.fcf77cd3.js"><link rel="prefetch" href="/assets/js/98.53ab7c12.js"><link rel="prefetch" href="/assets/js/99.d488142a.js"><link rel="prefetch" href="/assets/js/getag-map.64e16d15.js"><link rel="prefetch" href="/assets/js/vendors~bootstrap.6d48da59.js"><link rel="prefetch" href="/assets/js/vendors~masonry-layout.135896b3.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.9a9ceefc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e0e4cea7.css"><style data-vue-ssr-id="data-v-3ea4e60c_0">.bi{fill:currentColor;width:1em;height:1em;font-size:1em;margin-bottom:.125em;vertical-align:middle}.bi--variant-success{color:var(--bs-success)}.bi--variant-warning{color:var(--bs-warning)}.bi--variant-danger{color:var(--bs-danger)}.bi--variant-info{color:var(--bs-info)}.bi--variant-primary{color:var(--bs-primary)}.bi--variant-secondary{color:var(--bs-secondary)}.bi--variant-dark{color:var(--bs-dark)}.bi--variant-light{color:var(--bs-light)}.bi--size-sm{font-size:.75em}.bi--size-md{font-size:1.25rem}.bi--size-lg{font-size:1.33333333rem}.bi--size-2x{font-size:2rem}.bi--size-3x{font-size:3rem}.bi--size-4x{font-size:4rem}.bi--size-5x{font-size:5rem}.bi--animation-cylon{animation:bi-animation-cylon .75s ease-in-out infinite alternate}.bi--animation-cylon-vertical{animation:bi-animation-cylon-vertical .75s ease-in-out infinite alternate}.bi--animation-fade{animation:bi-animation-fade .75s ease-in-out infinite alternate}.bi--animation-spin{animation:bi-animation-spin 2s linear infinite normal}.bi--animation-spin-reverse{animation:bi-animation-spin 2s linear infinite reverse}.bi--animation-spin-pulse{animation:bi-animation-spin 1s steps(8) infinite normal}.bi--animation-spin-reverse-pulse{animation:bi-animation-spin 1s steps(8) infinite reverse}.bi--animation-throb{animation:bi-animation-throb .75s ease-in-out infinite alternate}@keyframes bi-animation-cylon{0%{transform:translateX(-25%)}100%{transform:translateX(25%)}}@keyframes bi-animation-cylon-vertical{0%{transform:translateY(25%)}100%{transform:translateY(-25%)}}@keyframes bi-animation-fade{0%{opacity:.1}100%{opacity:1}}@keyframes bi-animation-spin{0%{transform:rotate(0)}100%{transform:rotate(359deg)}}@keyframes bi-animation-throb{0%{opacity:.5;transform:scale(.5)}100%{opacity:1;transform:scale(1)}}
</style>
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="d-flex flex-column min-vh-100"><header class="container-fluid position-relative Header"><nav class="navbar navbar-expand-sm navbar-dark"><div class="container-lg"><a href="/" class="NavLink navbar-brand"><img src="https://cdn.dvuckovic.com/images/avatar.png" alt="Dusan’s Space" title="Dusan’s Space" height="32" class="d-block position-relative"></a> <button type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler"><svg class="bi bi--size-lg"><g transform="" transform-origin="center"><use xlink:href="/assets/img/bootstrap-icons.982100e4.svg#list"></use></g></svg></button> <div id="navbar" class="collapse navbar-collapse"><ul role="menu" class="navbar-nav align-items-end me-auto text-uppercase"><li role="menuitem" class="position-relative nav-item"><a href="/tag/post/" class="NavLink nav-link">
                            Posts
                        </a></li><li role="menuitem" class="position-relative nav-item"><a href="/tag/project/" class="NavLink nav-link">
                            Projects
                        </a></li><li role="menuitem" class="position-relative nav-item"><a href="/tag/photo/" class="NavLink nav-link">
                            Photos
                        </a></li><li role="menuitem" class="position-relative nav-item"><a href="/tag/panorama/" class="NavLink nav-link">
                            Panoramas
                        </a></li></ul> <ul class="navbar-nav justify-content-end align-items-end Header__Nav__Right"><li class="nav-item"><div class="search-box pe-4"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></li> <li class="nav-item"><a href="/rss.xml" title="Feed" class="Feed pe-4"><svg class="bi bi--size-md"><g transform="" transform-origin="center"><use xlink:href="/assets/img/bootstrap-icons.982100e4.svg#rss-fill"></use></g></svg></a></li> <li class="nav-item"><a href="https://instagram.com/dvuckovic82" target="_blank" rel="noopener noreferrer" title="Instagram" class="NavLink NavLink--External position-relative d-block pe-4"><svg class="bi bi--size-md"><g transform="" transform-origin="center"><use xlink:href="/assets/img/bootstrap-icons.982100e4.svg#instagram"></use></g></svg></a></li><li class="nav-item"><a href="https://github.com/dvuckovic" target="_blank" rel="noopener noreferrer" title="GitHub" class="NavLink NavLink--External position-relative d-block"><svg class="bi bi--size-md"><g transform="" transform-origin="center"><use xlink:href="/assets/img/bootstrap-icons.982100e4.svg#github"></use></g></svg></a></li></ul></div></div></nav> <!----></header> <article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="container-lg px-3 Post GlobalLayout"><div class="row justify-content-center"><header id="header" class="col-md-9 Post__Header"><ul itemprop="keywords" class="d-flex flex-row mb-2 list-unstyled Post__Meta Post__Meta--Tags"><li class="text-uppercase PostTag"><a href="/tag/post" class="me-3"><span>
            post
        </span></a></li><li class="text-uppercase PostTag"><a href="/tag/encryption" class="me-3"><span>
            encryption
        </span></a></li><li class="text-uppercase PostTag"><a href="/tag/gmail" class="me-3"><span>
            gmail
        </span></a></li><li class="text-uppercase PostTag"><a href="/tag/thunderbird" class="me-3"><span>
            thunderbird
        </span></a></li></ul> <h1 itemprop="name headline" class="Post__Title">
                Setup S/MIME Encryption for Gmail
            </h1> <p itemprop="description" class="mt-4 mb-4 Post__Summary">
                We got nothing to hide, but why not?
            </p> <footer><!----> <div class="text-uppercase Post__Meta Post__Meta--Date"><time itemprop="datePublished" datetime="2020-12-22T00:00:00.000Z">
                        2020-12-22
                    </time> <span class="mx-2">
                            •
                        </span>
                        15 minutes
                    </div></footer></header></div> <div class="row"><figure class="col Post__FullImage"><img src="https://cdn.dvuckovic.com/posts/smime-certificates.jpg" alt="Setup S/MIME Encryption for Gmail" sizes="(max-width: 800px) 400px, (max-width: 1170px) 1170px, 2000px" class="rounded w-100"></figure></div> <div class="row justify-content-center"><section itemprop="articleBody" class="col-md-9"><div class="Post__Content content__default"><p><em>UPDATE: For a guide on PGP encryption for Gmail, checkout <a href="/posts/setup-pgp-encryption-gmail.html">a separate post here</a>.</em></p> <p>It’s a sad truth that not one of the big email providers like <em>Gmail</em> support the <em>S/MIME encryption</em> in their products on a free plan. For a technology that dates back to 1990s, it’s almost trivial to implement it, but it looks like they decided to target mostly enterprise with this and similar security features.</p> <p>Which is probably non-sense: the corporate world would almost certainly have this up &amp; running on their own, as security is not something you would like to off-load to third parties.</p> <h2 id="shoddy-industry-practice"><a href="#shoddy-industry-practice" class="Permalink">#</a> Shoddy Industry Practice</h2> <p>Another unfortunate thing is that most of the certificate authorities out there have stopped with issuing free S/MIME certificates. At one point, all of the bigger names in the industry had a free plan which, while limited to a year or so, was still a viable option for many.</p> <p>At the end of year 2020, things are quite bad: <em>Comodo</em> was the last big name <a href="https://secure.nurd.com/products/purchase.php?area=SecureEmailCertificate" target="_blank" rel="noopener noreferrer">to stop issuing free certificates<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> at some point, and <em>Actalis</em> has <a href="https://extrassl.actalis.it/portal/uapub/freemail" target="_blank" rel="noopener noreferrer">an awful practice<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> of not allowing you to generate and keep a private key on your side.</p> <p>The thing is, unless you really need for a third party to identify your identity, you can still benefit from signing/encrypting emails on your own. You can be your own certificate authority 😉</p> <h2 id="checklist"><a href="#checklist" class="Permalink">#</a> Checklist</h2> <p>Well, the good news is that if you want to implement an S/MIME encryption workflow you are probably already good to go! All that you would need is:</p> <ul><li>Access to <em>Gmail</em> or a similar email service</li> <li>Relatively recent <em>OpenSSL</em> installation</li> <li>Some secure backup storage for sensitive data</li> <li><em>Thunderbird</em> or a similar email client</li></ul> <h2 id="openssl-setup"><a href="#openssl-setup" class="Permalink">#</a> OpenSSL Setup</h2> <p>First, you need up &amp; running <em>OpenSSL</em> setup. You are most likely to already have it installed, you can verify with the following console command:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ openssl version
LibreSSL <span class="token number">2.8</span>.3
</code></pre></div><p>In this case, command was run on a recent <em>macOS</em> system, and you can see that it’s using a <em>LibreSSL</em> variant.</p> <p>Using <em>OpenSSL</em> can be very daunting, but one way to simplify it is to prepare a configuration file that you will use for most of the actions that require many options to be defined.</p> <p>To do this for S/MIME certificate generation, simply put the following in a file called <code>smime.conf</code> in a folder of your choice:</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token selector">[req]</span>
<span class="token constant">distinguished_name</span> <span class="token attr-value"><span class="token punctuation">=</span> req_distinguished_name</span>
<span class="token selector">[req_distinguished_name]</span>
<span class="token constant">countryName</span> <span class="token attr-value"><span class="token punctuation">=</span> Country Name (2 letter code)</span>
<span class="token constant">countryName_default</span> <span class="token attr-value"><span class="token punctuation">=</span></span>
<span class="token constant">countryName_min</span> <span class="token attr-value"><span class="token punctuation">=</span> 2</span>
<span class="token constant">countryName_max</span> <span class="token attr-value"><span class="token punctuation">=</span> 2</span>
<span class="token constant">stateOrProvinceName</span> <span class="token attr-value"><span class="token punctuation">=</span> State or Province Name (full name)</span>
<span class="token constant">stateOrProvinceName_default</span> <span class="token attr-value"><span class="token punctuation">=</span></span>
<span class="token constant">localityName</span> <span class="token attr-value"><span class="token punctuation">=</span> Locality Name (eg, city)</span>
<span class="token constant">localityName_default</span> <span class="token attr-value"><span class="token punctuation">=</span></span>
<span class="token constant">0.organizationName</span> <span class="token attr-value"><span class="token punctuation">=</span> Organization Name (eg, company)</span>
<span class="token constant">0.organizationName_default</span> <span class="token attr-value"><span class="token punctuation">=</span></span>
<span class="token constant">organizationalUnitName</span> <span class="token attr-value"><span class="token punctuation">=</span> Organizational Unit Name (eg, section)</span>
<span class="token constant">organizationalUnitName_default</span> <span class="token attr-value"><span class="token punctuation">=</span></span>
<span class="token constant">commonName</span> <span class="token attr-value"><span class="token punctuation">=</span> Common Name (e.g. server FQDN or YOUR name)</span>
<span class="token constant">commonName_default</span> <span class="token attr-value"><span class="token punctuation">=</span></span>
<span class="token constant">commonName_max</span> <span class="token attr-value"><span class="token punctuation">=</span> 64</span>
<span class="token constant">emailAddress</span> <span class="token attr-value"><span class="token punctuation">=</span> Email Address</span>
<span class="token constant">emailAddress_default</span> <span class="token attr-value"><span class="token punctuation">=</span></span>
<span class="token constant">emailAddress_max</span> <span class="token attr-value"><span class="token punctuation">=</span> 40</span>
<span class="token selector">[smime]</span>
<span class="token constant">basicConstraints</span> <span class="token attr-value"><span class="token punctuation">=</span> CA:FALSE</span>
<span class="token constant">keyUsage</span> <span class="token attr-value"><span class="token punctuation">=</span> nonRepudiation, digitalSignature, keyEncipherment</span>
<span class="token constant">subjectKeyIdentifier</span> <span class="token attr-value"><span class="token punctuation">=</span> hash</span>
<span class="token constant">authorityKeyIdentifier</span> <span class="token attr-value"><span class="token punctuation">=</span> keyid:always,issuer</span>
<span class="token constant">subjectAltName</span> <span class="token attr-value"><span class="token punctuation">=</span> email:copy</span>
<span class="token constant">extendedKeyUsage</span> <span class="token attr-value"><span class="token punctuation">=</span> emailProtection</span>
</code></pre></div><p>Note that each of the fields can have a <code>*_default</code> value set, so whatever you put in there will be used out of box (however you can change it at the time of invocation).</p> <p>With config file in place, you can set an environment variable that points to it, so it will be used for remainder of your console session:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">OPENSSL_CONF</span><span class="token operator">=</span>/path/to/smime.conf
</code></pre></div><h2 id="generate-certificate-authority"><a href="#generate-certificate-authority" class="Permalink">#</a> Generate Certificate Authority</h2> <p><em>NOTE: You will need a separate CA for <em>each</em> self-signed certificate you create! I learned this the hard way, and it could be a bug in Thunderbird or something, but by sticking to this rule, you will probably have fewer issues down the line.</em></p> <p>First, generate a private key just for the purpose of your own certificate authority:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>openssl genrsa -aes256 -out ca.key <span class="token number">4096</span>
</code></pre></div><p>Provide a strong passphrase when asked, it will be used to secure your private key.</p> <div class="language- extra-class"><pre class="language-text"><code>Generating RSA private key, 4096 bit long modulus
........................................................................................................................................................++
...........................................................................................................................++
e is 65537 (0x10001)
Enter pass phrase for ca.key:
Verifying - Enter pass phrase for ca.key:
</code></pre></div><p>Next, generate a self-signed certificate for the certificate authority:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>openssl req -new -x509 -days <span class="token number">3650</span> -key ca.key -out ca.crt
</code></pre></div><p>You can choose which certificate fields you want to set, but keep in mind that <em>Common Name</em> (<code>commonName</code>) should be set to something senseful, like <strong>My Certificate Authority</strong>. Additionally, please keep the <em>Email Address</em> (<code>emailAddress</code>) empty (in case there is a default value, you can blank it by putting a dot <code>.</code> when prompted).</p> <div class="language- extra-class"><pre class="language-text"><code>Enter pass phrase for ca.key:
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) []:GB
State or Province Name (full name) []:Berkshire
Locality Name (eg, city) []:Reading
Organization Name (eg, company) []:
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN or YOUR name) []:My Certificate Authority
Email Address []:
</code></pre></div><h2 id="generate-s-mime-certificate"><a href="#generate-s-mime-certificate" class="Permalink">#</a> Generate S/MIME Certificate</h2> <p>Finally, we are ready to generate personal S/MIME certificate. We start by generating another private key for it:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>openssl genrsa -aes256 -out smime.key <span class="token number">4096</span>
</code></pre></div><p>Provide a strong passphrase when asked, it will be used to secure your private key.</p> <div class="language- extra-class"><pre class="language-text"><code>Generating RSA private key, 4096 bit long modulus
......................................................................++
......................++
e is 65537 (0x10001)
Enter pass phrase for smime.key:
Verifying - Enter pass phrase for smime.key:
</code></pre></div><p>Next, we can create a certificate signing request:</p> <div class="language- extra-class"><pre class="language-text"><code>openssl req -new -key smime.key -out smime.csr
</code></pre></div><p>You can choose which certificate fields you want to set, but keep in mind that <em>Common Name</em> (<code>commonName</code>) should be set to something senseful, like your full name. Additionally, please enter your account’s email address in the <em>Email Address</em> (<code>emailAddress</code>) field.</p> <div class="language- extra-class"><pre class="language-text"><code>Enter pass phrase for smime.key:
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) []:GB
State or Province Name (full name) []:Berkshire
Locality Name (eg, city) []:Reading
Organization Name (eg, company) []:
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN or YOUR name) []:John Doe
Email Address []:jdoe@example.com
</code></pre></div><p>Then, we can sign the certificate using the certificate authority we created in the previous step:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>openssl x509 -req -days <span class="token number">3650</span> -in smime.csr -CA ca.crt -CAkey ca.key -out smime.crt -set_serial <span class="token number">1</span> -addtrust emailProtection -addreject clientAuth -addreject serverAuth -trustout
</code></pre></div><p>In this case, we will create a certificate valid for <em>10</em> years (<em>3650</em> days), but you can change this value at this time.</p> <div class="language- extra-class"><pre class="language-text"><code>Signature ok
subject=/C=GB/ST=Berkshire/L=Reading/CN=John Doe/emailAddress=jdoe@example.com
Getting CA Private Key
Enter pass phrase for ca.key:
</code></pre></div><p>Finally, we can package the certificate into the widely recognized PKCS12 format:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>openssl pkcs12 -export -in smime.crt -inkey smime.key -out smime.p12
</code></pre></div><p>You will need to armor the certificate export with an additional passphrase, since it will contain the private key as well.</p> <div class="language- extra-class"><pre class="language-text"><code>Enter pass phrase for smime.key:
Enter Export Password:
Verifying - Enter Export Password:
</code></pre></div><h2 id="thunderbird-setup"><a href="#thunderbird-setup" class="Permalink">#</a> Thunderbird Setup</h2> <p>This guide assumes you already have your <em>Gmail</em> account setup in <em>Thunderbird</em>. It can be either via <em>IMAP</em> or <em>POP3</em> protocol, it doesn’t really matter. In case you are having trouble with this, check your settings in the <em>Gmail</em> web interface, and make sure the desired protocol is enabled. You can then use the new account wizard in <em>Thunderbird</em> for connecting your account and authenticating via <em>OAuth2</em>.</p> <p>Once the account is setup, go to the <strong>Tools &gt; Account Settings</strong> screen, and on <strong>End-To-End Encryption</strong> under your account click on the <strong>Manage S/MIME Certificates</strong> button:</p> <p><img src="https://cdn.dvuckovic.com/posts/smime-account-settings.png#nozoom" alt="Account Settings"></p> <p>Next, click on the <strong>Your Certificates</strong> tab and then on the <strong>Import</strong> button:</p> <p><img src="https://cdn.dvuckovic.com/posts/smime-import-certificate.png#nozoom" alt="Import Certificate"></p> <p>Point it to your PKCS12 file generated in the previous step (<code>smime.p12</code>) and click <strong>Open</strong>.</p> <p>Then, you need to also import your certificate authority, by going to the <strong>Authorities</strong> tab and clicking on <strong>Import</strong> button below. Point to the previously generated <code>ca.crt</code> file and click <strong>Open</strong>. In the next dialog, you can adjust the trust of your certificate authority, by marking the checkbox <strong>Trust this CA to identify email users.</strong> and confirm with <strong>OK</strong>. Close the dialog with another <strong>OK</strong>, and you will be back in the <strong>Account Settings</strong> screen.</p> <p>Finally, select your certificate in both signing and encryption fields by clicking <strong>Select</strong> next to each. Your certificate name should be easily identifiable via its <strong>Common Name</strong> field you set in one of the previous steps.</p> <p><img src="https://cdn.dvuckovic.com/posts/smime-select-certificate.png#nozoom" alt="Select Certificate"></p> <p>That’s it! You are now ready for some encryption tests.</p> <h2 id="test-signing"><a href="#test-signing" class="Permalink">#</a> Test Signing</h2> <p>Just fire off the write email button, and choose the <strong>Digitally Sign This Message</strong> option from the <strong>Security</strong> toolbar button. In case you don’t have the PGP mechanism set up, the <strong>Encryption Technology</strong> will default to <strong>S/MIME</strong> for you automatically.</p> <p><img src="https://cdn.dvuckovic.com/posts/smime-message-signing.png#nozoom" alt="Signing Message"></p> <p>Make sure the email is being sent out from you email address. For signing messages, the recipient does not have to have their S/MIME certificate set up.</p> <p>You can also just save a draft of the message, and check if it’s signed correctly without actually sending it. Look for a small sign badge in the upper right corner of the message preview, for a confirmation that signing was successful.</p> <p><img src="https://cdn.dvuckovic.com/posts/smime-message-signed.png#nozoom" alt="Signed Message Badge"></p> <h2 id="test-encryption"><a href="#test-encryption" class="Permalink">#</a> Test Encryption</h2> <p>To properly test the encryption with the certificate you just generated, you will need access to a second email account. To encrypt for the first email address, you actually need to add that address to the recipients (not the sender!).</p> <p>Similarly to the signing, you can write a message and activate <strong>Require Encryption</strong> option from the <strong>Security</strong> toolbar button.</p> <p><img src="https://cdn.dvuckovic.com/posts/smime-message-encryption.png#nozoom" alt="Encrypting Message"></p> <p>Saving the message as a draft will do the encryption for you, and you can check for confirmation again in the message preview header, where a suitable encrypted badge will be shown.</p> <p><img src="https://cdn.dvuckovic.com/posts/smime-message-encrypted.png#nozoom" alt="Encrypted Message Badge"></p> <h2 id="test-signing-encryption"><a href="#test-signing-encryption" class="Permalink">#</a> Test Signing &amp; Encryption</h2> <p>Full test can be pulled off by combining both options (<strong>Digitally Sign This Message</strong> and <strong>Require Encryption</strong>), but you need to understand it will be impossible to test both the signature and encryption with the same certificate. They are mutually exclusive, since you will always be signing only messages from your, and only incoming messages will be encrypted.</p> <p>However, in case you have access to another email account that has its own pair of certificates set up, you can at least simulate signed &amp; encrypted conversation. In that case, messages will be marked with a combined badge in their preview header.</p> <p><img src="https://cdn.dvuckovic.com/posts/smime-message-signed-encrypted.png#nozoom" alt="Signed &amp; Encrypted Message Badge"></p> <h2 id="conclusion"><a href="#conclusion" class="Permalink">#</a> Conclusion</h2> <p>Although it's not available for the web interface, approach outlined above is a viable way to have an S/MIME encryption workflow integrated in <em>Gmail</em> or other email services. Especially if seldomly used, in case of some sensitive correspondence.</p> <p>With certificates packaged and ready, you can also use them on other systems, for example on <em>Android</em> via a suitable app (warm recommendation for the <a href="https://email.faircode.eu/" target="_blank" rel="noopener noreferrer">FairEmail<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> app, which supports S/MIME encryption, although as a premium feature).</p> <p><small><em>Reference: <a href="https://www.dalesandro.net/create-self-signed-smime-certificates/" target="_blank" rel="noopener noreferrer">Create Self-Signed S/MIME Certificates<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> by John Dalesandro</em></small></p></div></section></div> <div class="row"><section itemprop="articleBody" class="col"><div class="Post__Content content__wide"></div></section></div> <div class="Sticker d-none d-xxl-block Toc position-fixed Toc" style="opacity:0;"><div class="Toc__Item Toc__H1"><a href="#app" title="Setup S/MIME Encryption for Gmail">
            Setup S/MIME Encryption for Gmail
        </a></div> <div class="Toc__Item Toc__H2 Toc__Item--Active"><a href="#shoddy-industry-practice" title="Shoddy Industry Practice">
            Shoddy Industry Practice
        </a></div><div class="Toc__Item Toc__H2"><a href="#checklist" title="Checklist">
            Checklist
        </a></div><div class="Toc__Item Toc__H2"><a href="#openssl-setup" title="OpenSSL Setup">
            OpenSSL Setup
        </a></div><div class="Toc__Item Toc__H2"><a href="#generate-certificate-authority" title="Generate Certificate Authority">
            Generate Certificate Authority
        </a></div><div class="Toc__Item Toc__H2"><a href="#generate-s-mime-certificate" title="Generate S/MIME Certificate">
            Generate S/MIME Certificate
        </a></div><div class="Toc__Item Toc__H2"><a href="#thunderbird-setup" title="Thunderbird Setup">
            Thunderbird Setup
        </a></div><div class="Toc__Item Toc__H2"><a href="#test-signing" title="Test Signing">
            Test Signing
        </a></div><div class="Toc__Item Toc__H2"><a href="#test-encryption" title="Test Encryption">
            Test Encryption
        </a></div><div class="Toc__Item Toc__H2"><a href="#test-signing-encryption" title="Test Signing &amp; Encryption">
            Test Signing &amp; Encryption
        </a></div><div class="Toc__Item Toc__H2"><a href="#conclusion" title="Conclusion">
            Conclusion
        </a></div></div></article> <footer class="container-fluid flex-grow-1 Footer"><div class="container-lg my-3"><div class="row align-items-center"><div class="col-lg-3 order-3 order-lg-1"><ul role="menu" class="d-flex flex-row justify-content-center justify-content-lg-start m-0 list-unstyled"><li role="menuitem" class="Footer__Nav__Item"><a href="/" class="NavLink">
                            © 2021 Dusan Vuckovic
                        </a></li></ul></div> <div class="col-lg-6 order-2 mt-1 mb-2 mb-lg-0 Footer__Center"><ul role="menu" class="d-flex flex-wrap justify-content-center m-0 list-unstyled"><li role="menuitem" class="mb-1 me-1 Footer__Nav__Item"><a href="https://vuepress.vuejs.org" target="_blank" class="NavLink NavLink--External"><img src="https://img.shields.io/badge/powered_by-VuePress-3eaf7c?logo=Vue.js" alt="Powered by VuePress"></a></li><li role="menuitem" class="mb-1 me-1 Footer__Nav__Item"><a href="https://www.cloudflare.com" target="_blank" class="NavLink NavLink--External"><img src="https://img.shields.io/badge/secured_by-Cloudflare-f38020?logo=cloudflare" alt="Secured by Cloudflare"></a></li><li role="menuitem" class="mb-1 me-1 Footer__Nav__Item"><a href="http://www.wtfpl.net" target="_blank" class="NavLink NavLink--External"><img src="https://img.shields.io/badge/license-WTFPL-white" alt="Licensed as WTFPL"></a></li></ul></div> <div class="col-lg-3 order-1 order-lg-3 mb-2 mb-lg-0"><ul role="menu" class="d-flex flex-row justify-content-center justify-content-lg-end m-0 list-unstyled"><li role="menuitem" class="Footer__Nav__Item"><a href="#email-modal" data-bs-toggle="modal" class="NavLink NavLink--External">
                            Email
                        </a></li><li role="menuitem" class="Footer__Nav__Item"><a href="/privacy-policy.html" class="NavLink">
                            Privacy
                        </a></li><li role="menuitem" class="Footer__Nav__Item"><a href="https://github.com/dvuckovic" target="_blank" class="NavLink NavLink--External">
                            Github
                        </a></li></ul></div></div></div></footer> <div id="email-modal" tabindex="-1" aria-hidden="true" class="modal fade"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h2 class="modal-title">Hey there!</h2></div> <div class="modal-body"><p>The best way to get in touch with me directly is to drop me an email.</p>
<p>My email address is my <strong>given name</strong> at this website.</p>
<p><em>If you want to send me a secure message, you can get <a href="https://cdn.dvuckovic.com/downloads/dvuckovic.crt" class="NavLink NavLink--PublicKey" download>my S/MIME certificate</a>.</em></p><p><small><em>Or, if you prefer PGP, get <a href="https://cdn.dvuckovic.com/downloads/dvuckovic.pub" class="NavLink NavLink--PublicKey" download>my public key</a>.</em></small></p></div> <div class="modal-footer"><button type="button" data-bs-dismiss="modal" class="btn btn-primary">Got it!</button></div></div></div></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7a75f1fe.js" defer></script><script src="/assets/js/19.1346b3bf.js" defer></script><script src="/assets/js/12.e1236284.js" defer></script><script src="/assets/js/139.f7100a2e.js" defer></script>
  </body>
</html>
