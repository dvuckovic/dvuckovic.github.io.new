(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{1206:function(e,t,a){"use strict";a.r(t);var s=a(9),n=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("p",[e._v("As a personal collection of large files grows, one has always problems with additional storage. Once the problem was with not enough disk space, but today it may as well be the physical space to store the disks. A computer case is only as big, and soon you canâ€™t add new disks, because there is simply no room in it. This is a problem I first faced a couple of years ago, and pondered ever since to solve it.")]),e._v(" "),a("h2",{attrs:{id:"first-approach-data-tank"}},[a("a",{staticClass:"Permalink",attrs:{href:"#first-approach-data-tank"}},[e._v("#")]),e._v(" First approach (data tank)")]),e._v(" "),a("p",[e._v("At first I tried physically moving the disks in a new case, with separate power supply, and connecting it via eSATA interfaces to the main computer. Aside from a simple hack in order to turn on the power supply and disks without a dedicated motherboard, it worked pretty well. Speed was top-notch, because disks were plugged over PCI-E SATA2 controllers, and they were pretty much considered part of the machine.")]),e._v(" "),a("p",[e._v("But, there was a major drawback: data was locked to the computer the data tank was attached to, and I simply wasnâ€™t able to make the power management work with Windows OS. Diskâ€™s were spun up all at once for the remainder of the session, and I had to manually spin them down in order to turn them off. Very complicated procedure and takes a lot of time.")]),e._v(" "),a("h2",{attrs:{id:"contemplating-hardware"}},[a("a",{staticClass:"Permalink",attrs:{href:"#contemplating-hardware"}},[e._v("#")]),e._v(" Contemplating hardware")]),e._v(" "),a("p",[e._v("Since I bought a cheap BTX case, I couldnâ€™t just put a computer in it, well because it was a BTX case ðŸ˜‰ I had an old AMD Duron based MB in storage, and was thinking of putting it in a good use. Luckily enough, it turns out BTX power supply was compatible with the old ATX board, save for one shaved off plastic hook. So, I had disks and PSU, and needed to acquire only:")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("a roomy ATX tower (turns out "),a("a",{attrs:{href:"http://www.coolermaster.com/product.php?product_id=5239&category_id=3586",target:"_blank",rel:"noopener noreferrer"}},[e._v("CoolerMaster Elite 335 w/o PSU"),a("OutboundLink")],1),e._v(' was a bargain, with plenty of space in 3.5" and 5.25" slots)')])]),e._v(" "),a("li",[a("p",[e._v("2 additional "),a("a",{attrs:{href:"http://www.siliconimage.com/products/product.aspx?pid=63",target:"_blank",rel:"noopener noreferrer"}},[e._v("PCI SATA controllers with 2 ports each"),a("OutboundLink")],1),e._v(" (because old Duron MB didnâ€™t have any)")])])]),e._v(" "),a("p",[e._v('It was a cheap "upgrade", well below 100â‚¬ mark, and I was really happy about reviving an old computer which was starting to pick up dust.')]),e._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.dvuckovic.com/posts/_MG_2038.jpg",alt:"Closeup of 5 1TB Samsung drives"}})]),e._v(" "),a("h2",{attrs:{id:"software"}},[a("a",{staticClass:"Permalink",attrs:{href:"#software"}},[e._v("#")]),e._v(" Software")]),e._v(" "),a("p",[e._v("There is a plenty of options for a NAS server these days ("),a("a",{attrs:{href:"http://freenas.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("FreeNAS"),a("OutboundLink")],1),e._v(" being on of them), mostly based on customized Linux distributions. But I was puzzled that not a single one of them provided a GUI mode out-of-box (no X server, no Windows manager, only console mode). This was remedied mostly with Web interfaces for each service, but what if one wanted to run a program that runs only in GUI mode? There are many examples of programs running only in GUI mode ("),a("a",{attrs:{href:"http://jdownloader.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("JDownloader"),a("OutboundLink")],1),e._v(" being one of them).")]),e._v(" "),a("p",[e._v("Since there is abundance of stable and reliable Linux distributions out there, I started to think if I would be able to configure one to suit my needs as a NAS. "),a("a",{attrs:{href:"http://www.ubuntu.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Ubuntu"),a("OutboundLink")],1),e._v(" was a logical choice (Desktop Edition), since it has a massive support base, and countless boards dedicated to it.")]),e._v(" "),a("p",[e._v("I didnâ€™t wanted to reformat disks I have already filled to the brim, so they should be left as NTFS. I remembered that Linux had some problems with Microsoftâ€™s filesystem in the past (e.g. read-only access), but was pleased to read that Ubuntu 10.10 comes with NTFS-3G installed. It is not as speedy as it could be under Windows, but itâ€™s close, and speed wonâ€™t be an issue since I plan to hook this thing to a 100Mbit home router. And also, I had a guarantee that if the experiment with Linux collapsed, I could still access all data from a Windows box.")]),e._v(" "),a("h3",{attrs:{id:"installing-ubuntu"}},[a("a",{staticClass:"Permalink",attrs:{href:"#installing-ubuntu"}},[e._v("#")]),e._v(" Installing Ubuntu")]),e._v(" "),a("p",[e._v("Piece of cake, but a bitter one. I managed to install Ubuntu some 5 times, before I finally realized a problem Iâ€™ve been having with freeze on login: my old Matrox AGP card was not supported. Rather than try all driver possibilities (VESA, VGA, etc), I found an old GeForce2 AGP card in my collection, swapped it, and everything went without a hitch after this. Maybe it was my error that I didnâ€™t fully read HCL for Ubuntu 10.10 before attempting it to install on a really old piece of hardware, but I was happy that I resolved the problem quickly.")]),e._v(" "),a("p",[e._v("I put the Ubuntu installation to a smaller 40 GB Maxtor Raptor 10k RPM disk, and added a 500 GB Seagate disk as a temp (for downloads, etc). My collection was, however, contained on 5 identical Samsung 1TB disks, so I needed as many SATA ports I could get. One 3114 PCI card (4 ports) and two 3112 PCI cards (2 ports) seemed enough, for this setup, at least.")]),e._v(" "),a("h3",{attrs:{id:"setting-up-services"}},[a("a",{staticClass:"Permalink",attrs:{href:"#setting-up-services"}},[e._v("#")]),e._v(" Setting up services")]),e._v(" "),a("p",[e._v("Ubuntu comes with a plethora of services preinstalled, but I did have somewhat special case. I wanted to have a headless server (w/o direct input), to fully support Windows home network (Samba) and a liberal power management (disks standby).")]),e._v(" "),a("p",[e._v("For a remote access, I enabled Remote Desktop in Ubuntu (vino based). It is accessed from System > Preferences > Remote Desktop menu. Vino runs on standard VNC port 5900, so it is probably good idea to forward it on the router. For VNC clients I would recommend TightVNC (Windows) and Chicken of the VNC (Mac).")]),e._v(" "),a("p",[e._v("SSH is always a good thing to have. To install it simply type following command in Terminal:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("user@ubuntu:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt-get")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" openssh-server\n")])])]),a("p",[a("code",[e._v("apt-get")]),e._v("is part of Advanced Packaging Tool (APT), popular packaging manager on Debian and its variants. OpenSSH implementation comes with a handy SFTP service, which is a lot like regular FTP, but is tunnelled over SSH and supports nice features such as remote copy and shell executions. SSH runs by default on port 22 (forwarded by router), and there are plenty of clients on all major OSs (putty on Windows, ssh on Mac/Linux).")]),e._v(" "),a("p",[e._v("Samba is a free implementation of Windows networking under Linux, and, for a difference, it works very well. Installation is simple:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("user@ubuntu:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt-get")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" samba samba-common samba-common-bin\nuser@ubuntu:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt-get")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" system-config-samba\n")])])]),a("p",[e._v("Second command installs a handy GUI configuration utility. To access it go to System > Administration > Samba, and you can set up shares there. I set up only one, because I intend to mount all my disks in sub-folders in it. Since Windows network works only in local, I enabled guest access, because I didnâ€™t want to bother with entering user/pass on every single client.")]),e._v(" "),a("h3",{attrs:{id:"managing-disks"}},[a("a",{staticClass:"Permalink",attrs:{href:"#managing-disks"}},[e._v("#")]),e._v(" Managing disks")]),e._v(" "),a("p",[e._v("In order to auto-mount disks to predefined mount points under Linux, editing of fstab is encouraged. There are two approaches in order to determine which disk to mount, and the more recent and correct way is to use UUID of the disk partition, since their "),a("code",[e._v("/dev/sd[a-z]")]),e._v(" designations might change when tampered with. To obtain the list of all UUIDs on the system, use the following command:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("user@ubuntu:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" blkid\n")])])]),a("p",[e._v("It will list all partitions and corresponding UUIDs. Copy the desired one, and then edit fstab:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("user@ubuntu:~$ sudo nano /etc/fstab\n")])])]),a("p",[e._v("Each disk partition should have its own line in the configuration file in order to auto-mount it:")]),e._v(" "),a("div",{staticClass:"language-apacheconf extra-class"},[a("pre",{pre:!0,attrs:{class:"language-apacheconf"}},[a("code",[e._v("UUID=YOUR_UUID   /mount/point   <filesystem_type>   <options>   <dump>   <pass>\n")])])]),a("p",[e._v("e.g.")]),e._v(" "),a("div",{staticClass:"language-apacheconf extra-class"},[a("pre",{pre:!0,attrs:{class:"language-apacheconf"}},[a("code",[e._v("UUID=6C6445206444EE80   /home/duca/Shared/1   ntfs-3g   defaults   0   0\n")])])]),a("p",[e._v("Power management for disks is a little more complicated. There is a utility called "),a("code",[e._v("hdparm")]),e._v(' that manages this, but I was unsuccessful at first. Commands simply failed to spin down hard disks, and finally I found out the reason. Turns out newer hard disks (especially "Green" ones) have embedded APM, and in order to switch the control to the OS, they should be disabled. Luckily '),a("code",[e._v("hdparm")]),e._v(" has this option, with a "),a("code",[e._v("-B")]),e._v(" switch:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("user@ubuntu:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" hdparm -B "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("255")]),e._v(" /dev/sda\n")])])]),a("p",[e._v("This will disable internal APM in the disk, and now you can spin down disk by using:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("user@ubuntu:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" hdparm -y /dev/sda\n")])])]),a("p",[e._v("In order to automate these settings you can edit "),a("code",[e._v("/etc/hdparm.conf")]),e._v(" file and add following for each disk:")]),e._v(" "),a("div",{staticClass:"language-apacheconf extra-class"},[a("pre",{pre:!0,attrs:{class:"language-apacheconf"}},[a("code",[e._v("/dev/sda {\n    apm = 255\n    poweron_standby = off\n    keep_features_over_reset = on\n}\n")])])]),a("p",[e._v("Now that you can spin the disks down, you will want a manager that will monitor the disk activity and put them to stand by accordingly. I stumbled upon "),a("a",{attrs:{href:"http://code.google.com/p/spindown/",target:"_blank",rel:"noopener noreferrer"}},[e._v("spindown"),a("OutboundLink")],1),e._v(" project that does this very good, and it only needs to be configured right in order to work. Spindown should be installed by following its installation instructions, but first make sure you have build essentials on your box:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("user@ubuntu:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt-get")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("make")]),e._v(" g++ build-essential\n")])])]),a("p",[e._v("Now you can download and build spindown:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("user@ubuntu:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("wget")]),e._v(" http://spindown.googlecode.com/files/spindown-0.4.0.tar.gz\nuser@ubuntu:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("tar")]),e._v(" xvzf spindown-0.4.0.tar.gz\nuser@ubuntu:~$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" spindown-0.4.0/\nuser@ubuntu:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("make")]),e._v("\nuser@ubuntu:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("make")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v("\n")])])]),a("p",[e._v("To configure spindown, first copy the sample configuration to "),a("code",[e._v("/etc")]),e._v(", then list your disks by ID and then edit the conf file:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("user@ubuntu:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("cp")]),e._v(" spindown.conf.example /etc/spindown.conf\nuser@ubuntu:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("ls")]),e._v(" -l /dev/disk/by-id/\nlrwxrwxrwx "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" root root  "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("9")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2010")]),e._v("-12-22 08:37 ata-ST3500320AS_9QM0BGVG -"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v("/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v("/sdb\nuser@ubuntu:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("nano")]),e._v(" /etc/spindown.conf\n")])])]),a("p",[e._v("The list line contains the disk ID, and you should note it down in order to edit configuration. Each disk should have its own block in "),a("code",[e._v(".conf")]),e._v(" file, following an example:")]),e._v(" "),a("div",{staticClass:"language-apacheconf extra-class"},[a("pre",{pre:!0,attrs:{class:"language-apacheconf"}},[a("code",[e._v("[Disk 1]\nid = ata-ST3500320AS_9QM0BGVG\nspindown = 1\ncommand = hdparm -y\n")])])]),a("p",[e._v("For the idle interval global setting should be set ("),a("code",[e._v("idle-time")]),e._v("), and then each exception changed in appropriate disk block. I set my global "),a("code",[e._v("idle-time")]),e._v(" to 900 seconds (15 minutes), and then prolonged it for temp disk to 1800 seconds (30 minutes).")]),e._v(" "),a("p",[e._v("You can always check the status of your disks by issuing:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("user@ubuntu:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("service")]),e._v(" spindown status\n * spindown is running\nname     watched     active       idle-time        spindown-time\nsda            "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("               "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("5")]),e._v("                 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3600")]),e._v("\nsdb            "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("16547")]),e._v("                 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1800")]),e._v("\nsde            "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("16735")]),e._v("                  "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("900")]),e._v("\nsdd            "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("16735")]),e._v("                  "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("900")]),e._v("\nsdg            "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("16735")]),e._v("                  "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("900")]),e._v("\nsdf            "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("16734")]),e._v("                  "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("900")]),e._v("\nsdc            "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("16735")]),e._v("                  "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("900")]),e._v("\n")])])]),a("p",[e._v("And to check if the disk has indeed been put to standby:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("user@ubuntu:~$ sudo hdparm -C /dev/sdb\n/dev/sdb:\n drive state is:  standby\n")])])]),a("h3",{attrs:{id:"conclusion"}},[a("a",{staticClass:"Permalink",attrs:{href:"#conclusion"}},[e._v("#")]),e._v(" Conclusion")]),e._v(" "),a("p",[e._v("First, I was very impressed by the elegance of setting up a modern Linux box, chances are that if somebody already posted something that worked for them, it will work for you too. Of course, you canâ€™t find everything you need in one place, but if you know what you are looking for, somebody probably have already figured it out.")]),e._v(" "),a("p",[e._v("Second, most things work out-of-box, as expected, in contrast to other OSs where every single thing is plagued with bugs. For the first time I have a fully working Windows network, ironically set up using Linux ðŸ˜„ And stability of it is just amazing: itâ€™s been now almost a month since I set up this box, and not a single restart was needed.")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.dvuckovic.com/posts/_MG_2040.jpg",alt:"System and Temp drives"}})])])}),[],!1,null,null,null);t.default=n.exports}}]);