<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>A DIY NAS with Ubuntu | Dusan’s Space</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&amp;family=Merriweather+Sans:ital,wght@0,600;1,600&amp;family=Merriweather:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&amp;display=swap">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-SJD4XMS3R4"></script>
    <script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-SJD4XMS3R4');</script>
    <link rel="alternate" type="application/rss+xml" href="https://dvuckovic.com/rss.xml" title="Dusan’s Space RSS Feed">
    <meta name="description" content="Personal experience with a NAS box based on Linux">
    <meta property="article:published_time" content="2010-12-24T00:00:00.000Z">
    <meta property="article:modified_time" content="2021-06-20T12:02:17.000Z">
    <meta property="og:site_name" content="Dusan’s Space">
    <meta property="og:title" content="A DIY NAS with Ubuntu">
    <meta property="og:description" content="Personal experience with a NAS box based on Linux">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/2010/12/24/diy-nas-ubuntu/">
    <meta property="og:image" content="https://cdn.dvuckovic.com/posts/ubuntu-nas_header.jpg">
    <meta name="twitter:title" content="A DIY NAS with Ubuntu">
    <meta name="twitter:description" content="Personal experience with a NAS box based on Linux">
    <meta name="twitter:url" content="/2010/12/24/diy-nas-ubuntu/">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://cdn.dvuckovic.com/posts/ubuntu-nas_header.jpg">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="post, diy, hardware, linux, ubuntu">
    <meta property="article:tag" content="post">
    <meta name="theme-color" content="#ff7700">
    <link rel="preload" href="/assets/css/0.styles.e0e4cea7.css" as="style"><link rel="preload" href="/assets/js/app.7a75f1fe.js" as="script"><link rel="preload" href="/assets/js/19.1346b3bf.js" as="script"><link rel="preload" href="/assets/js/12.e1236284.js" as="script"><link rel="preload" href="/assets/js/39.6a747384.js" as="script"><link rel="prefetch" href="/assets/js/1.47b44be3.js"><link rel="prefetch" href="/assets/js/10.9100961c.js"><link rel="prefetch" href="/assets/js/100.75b666b5.js"><link rel="prefetch" href="/assets/js/101.b3bbfd39.js"><link rel="prefetch" href="/assets/js/102.cbe66969.js"><link rel="prefetch" href="/assets/js/103.b08a0869.js"><link rel="prefetch" href="/assets/js/104.b4824db2.js"><link rel="prefetch" href="/assets/js/105.e8e6da25.js"><link rel="prefetch" href="/assets/js/106.df067897.js"><link rel="prefetch" href="/assets/js/107.4f834df4.js"><link rel="prefetch" href="/assets/js/108.b9fa77db.js"><link rel="prefetch" href="/assets/js/109.39b66c07.js"><link rel="prefetch" href="/assets/js/11.2d771e9d.js"><link rel="prefetch" href="/assets/js/110.a72e9012.js"><link rel="prefetch" href="/assets/js/111.8f8d0d52.js"><link rel="prefetch" href="/assets/js/112.483c0499.js"><link rel="prefetch" href="/assets/js/113.53a1b0ec.js"><link rel="prefetch" href="/assets/js/114.994e6fc6.js"><link rel="prefetch" href="/assets/js/115.d019b3b3.js"><link rel="prefetch" href="/assets/js/116.7da14914.js"><link rel="prefetch" href="/assets/js/117.354f5fc2.js"><link rel="prefetch" href="/assets/js/118.4bd88bb2.js"><link rel="prefetch" href="/assets/js/119.5bae7b8d.js"><link rel="prefetch" href="/assets/js/120.e909e859.js"><link rel="prefetch" href="/assets/js/121.cc4c1bb4.js"><link rel="prefetch" href="/assets/js/122.e935a102.js"><link rel="prefetch" href="/assets/js/123.bd515f08.js"><link rel="prefetch" href="/assets/js/124.f307495d.js"><link rel="prefetch" href="/assets/js/125.494e6420.js"><link rel="prefetch" href="/assets/js/126.cf0aa04c.js"><link rel="prefetch" href="/assets/js/127.127e1e9d.js"><link rel="prefetch" href="/assets/js/128.a13966fc.js"><link rel="prefetch" href="/assets/js/129.fb9a5055.js"><link rel="prefetch" href="/assets/js/13.4a201018.js"><link rel="prefetch" href="/assets/js/130.0bab81cb.js"><link rel="prefetch" href="/assets/js/131.8d311242.js"><link rel="prefetch" href="/assets/js/132.f67d9af5.js"><link rel="prefetch" href="/assets/js/133.0901673e.js"><link rel="prefetch" href="/assets/js/134.4fd746f6.js"><link rel="prefetch" href="/assets/js/135.48d3c5be.js"><link rel="prefetch" href="/assets/js/136.87d5eb67.js"><link rel="prefetch" href="/assets/js/137.6552c782.js"><link rel="prefetch" href="/assets/js/138.eb4cae8e.js"><link rel="prefetch" href="/assets/js/139.f7100a2e.js"><link rel="prefetch" href="/assets/js/14.1e9f23d3.js"><link rel="prefetch" href="/assets/js/140.e742b946.js"><link rel="prefetch" href="/assets/js/141.9fec0628.js"><link rel="prefetch" href="/assets/js/142.0c3c7ddb.js"><link rel="prefetch" href="/assets/js/143.04245474.js"><link rel="prefetch" href="/assets/js/144.3abcb36c.js"><link rel="prefetch" href="/assets/js/15.ff2cd584.js"><link rel="prefetch" href="/assets/js/16.f4971c4d.js"><link rel="prefetch" href="/assets/js/17.075cedfd.js"><link rel="prefetch" href="/assets/js/18.d792f2ec.js"><link rel="prefetch" href="/assets/js/2.c692d64a.js"><link rel="prefetch" href="/assets/js/20.15be60dc.js"><link rel="prefetch" href="/assets/js/21.c1a7bfa3.js"><link rel="prefetch" href="/assets/js/22.943f67ea.js"><link rel="prefetch" href="/assets/js/23.f431f4d6.js"><link rel="prefetch" href="/assets/js/24.339c4804.js"><link rel="prefetch" href="/assets/js/25.c67844dd.js"><link rel="prefetch" href="/assets/js/26.a52a97e9.js"><link rel="prefetch" href="/assets/js/27.dfbd74dc.js"><link rel="prefetch" href="/assets/js/28.de140592.js"><link rel="prefetch" href="/assets/js/29.de0191f6.js"><link rel="prefetch" href="/assets/js/3.22cfc250.js"><link rel="prefetch" href="/assets/js/30.5ec4efe2.js"><link rel="prefetch" href="/assets/js/31.3b982379.js"><link rel="prefetch" href="/assets/js/32.c6814f82.js"><link rel="prefetch" href="/assets/js/33.e7bb6f69.js"><link rel="prefetch" href="/assets/js/34.9dc51e9f.js"><link rel="prefetch" href="/assets/js/35.113cecc0.js"><link rel="prefetch" href="/assets/js/36.3b4c1524.js"><link rel="prefetch" href="/assets/js/37.514cbc8e.js"><link rel="prefetch" href="/assets/js/38.6c805e13.js"><link rel="prefetch" href="/assets/js/40.0c1f511e.js"><link rel="prefetch" href="/assets/js/41.8232996f.js"><link rel="prefetch" href="/assets/js/42.9cc151a3.js"><link rel="prefetch" href="/assets/js/43.ac76176b.js"><link rel="prefetch" href="/assets/js/44.5c73c2ae.js"><link rel="prefetch" href="/assets/js/45.8aa2357a.js"><link rel="prefetch" href="/assets/js/46.d2a10c93.js"><link rel="prefetch" href="/assets/js/47.92d84b19.js"><link rel="prefetch" href="/assets/js/48.5fd68038.js"><link rel="prefetch" href="/assets/js/49.975e7623.js"><link rel="prefetch" href="/assets/js/50.2a526f11.js"><link rel="prefetch" href="/assets/js/51.0b39be9e.js"><link rel="prefetch" href="/assets/js/52.1569c0e2.js"><link rel="prefetch" href="/assets/js/53.357bb5b0.js"><link rel="prefetch" href="/assets/js/54.d2f0ee28.js"><link rel="prefetch" href="/assets/js/55.5a6dce91.js"><link rel="prefetch" href="/assets/js/56.443679dc.js"><link rel="prefetch" href="/assets/js/57.591116bf.js"><link rel="prefetch" href="/assets/js/58.6079e6ab.js"><link rel="prefetch" href="/assets/js/59.10b56410.js"><link rel="prefetch" href="/assets/js/60.2042eab2.js"><link rel="prefetch" href="/assets/js/61.f3d5a99f.js"><link rel="prefetch" href="/assets/js/62.ca93a9e8.js"><link rel="prefetch" href="/assets/js/63.5f72d7fe.js"><link rel="prefetch" href="/assets/js/64.02655094.js"><link rel="prefetch" href="/assets/js/65.ed2d18c4.js"><link rel="prefetch" href="/assets/js/66.04ff7e44.js"><link rel="prefetch" href="/assets/js/67.95f7e57e.js"><link rel="prefetch" href="/assets/js/68.92b2a93f.js"><link rel="prefetch" href="/assets/js/69.7be4992d.js"><link rel="prefetch" href="/assets/js/70.3f9ad26a.js"><link rel="prefetch" href="/assets/js/71.d981d4cf.js"><link rel="prefetch" href="/assets/js/72.6468e54e.js"><link rel="prefetch" href="/assets/js/73.511ae092.js"><link rel="prefetch" href="/assets/js/74.228329eb.js"><link rel="prefetch" href="/assets/js/75.0d8b8262.js"><link rel="prefetch" href="/assets/js/76.e871abb9.js"><link rel="prefetch" href="/assets/js/77.1c43e23d.js"><link rel="prefetch" href="/assets/js/78.a97e55eb.js"><link rel="prefetch" href="/assets/js/79.d3714341.js"><link rel="prefetch" href="/assets/js/80.f5e67788.js"><link rel="prefetch" href="/assets/js/81.424fac9a.js"><link rel="prefetch" href="/assets/js/82.896a47aa.js"><link rel="prefetch" href="/assets/js/83.b23ff087.js"><link rel="prefetch" href="/assets/js/84.8cd76b1e.js"><link rel="prefetch" href="/assets/js/85.74ffdeee.js"><link rel="prefetch" href="/assets/js/86.4e98c5e0.js"><link rel="prefetch" href="/assets/js/87.5842ad2a.js"><link rel="prefetch" href="/assets/js/88.ea409a24.js"><link rel="prefetch" href="/assets/js/89.8e3cfb1e.js"><link rel="prefetch" href="/assets/js/9.73534068.js"><link rel="prefetch" href="/assets/js/90.544ae8d5.js"><link rel="prefetch" href="/assets/js/91.b2bf80c8.js"><link rel="prefetch" href="/assets/js/92.9e37cf18.js"><link rel="prefetch" href="/assets/js/93.d2624e22.js"><link rel="prefetch" href="/assets/js/94.70594964.js"><link rel="prefetch" href="/assets/js/95.fdc05f59.js"><link rel="prefetch" href="/assets/js/96.5a1bf07d.js"><link rel="prefetch" href="/assets/js/97.fcf77cd3.js"><link rel="prefetch" href="/assets/js/98.53ab7c12.js"><link rel="prefetch" href="/assets/js/99.d488142a.js"><link rel="prefetch" href="/assets/js/getag-map.64e16d15.js"><link rel="prefetch" href="/assets/js/vendors~bootstrap.6d48da59.js"><link rel="prefetch" href="/assets/js/vendors~masonry-layout.135896b3.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.9a9ceefc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e0e4cea7.css"><style data-vue-ssr-id="data-v-3ea4e60c_0">.bi{fill:currentColor;width:1em;height:1em;font-size:1em;margin-bottom:.125em;vertical-align:middle}.bi--variant-success{color:var(--bs-success)}.bi--variant-warning{color:var(--bs-warning)}.bi--variant-danger{color:var(--bs-danger)}.bi--variant-info{color:var(--bs-info)}.bi--variant-primary{color:var(--bs-primary)}.bi--variant-secondary{color:var(--bs-secondary)}.bi--variant-dark{color:var(--bs-dark)}.bi--variant-light{color:var(--bs-light)}.bi--size-sm{font-size:.75em}.bi--size-md{font-size:1.25rem}.bi--size-lg{font-size:1.33333333rem}.bi--size-2x{font-size:2rem}.bi--size-3x{font-size:3rem}.bi--size-4x{font-size:4rem}.bi--size-5x{font-size:5rem}.bi--animation-cylon{animation:bi-animation-cylon .75s ease-in-out infinite alternate}.bi--animation-cylon-vertical{animation:bi-animation-cylon-vertical .75s ease-in-out infinite alternate}.bi--animation-fade{animation:bi-animation-fade .75s ease-in-out infinite alternate}.bi--animation-spin{animation:bi-animation-spin 2s linear infinite normal}.bi--animation-spin-reverse{animation:bi-animation-spin 2s linear infinite reverse}.bi--animation-spin-pulse{animation:bi-animation-spin 1s steps(8) infinite normal}.bi--animation-spin-reverse-pulse{animation:bi-animation-spin 1s steps(8) infinite reverse}.bi--animation-throb{animation:bi-animation-throb .75s ease-in-out infinite alternate}@keyframes bi-animation-cylon{0%{transform:translateX(-25%)}100%{transform:translateX(25%)}}@keyframes bi-animation-cylon-vertical{0%{transform:translateY(25%)}100%{transform:translateY(-25%)}}@keyframes bi-animation-fade{0%{opacity:.1}100%{opacity:1}}@keyframes bi-animation-spin{0%{transform:rotate(0)}100%{transform:rotate(359deg)}}@keyframes bi-animation-throb{0%{opacity:.5;transform:scale(.5)}100%{opacity:1;transform:scale(1)}}
</style>
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="d-flex flex-column min-vh-100"><header class="container-fluid position-relative Header"><nav class="navbar navbar-expand-sm navbar-dark"><div class="container-lg"><a href="/" class="NavLink navbar-brand"><img src="https://cdn.dvuckovic.com/images/avatar.png" alt="Dusan’s Space" title="Dusan’s Space" height="32" class="d-block position-relative"></a> <button type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler"><svg class="bi bi--size-lg"><g transform="" transform-origin="center"><use xlink:href="/assets/img/bootstrap-icons.982100e4.svg#list"></use></g></svg></button> <div id="navbar" class="collapse navbar-collapse"><ul role="menu" class="navbar-nav align-items-end me-auto text-uppercase"><li role="menuitem" class="position-relative nav-item"><a href="/tag/post/" class="NavLink nav-link">
                            Posts
                        </a></li><li role="menuitem" class="position-relative nav-item"><a href="/tag/project/" class="NavLink nav-link">
                            Projects
                        </a></li><li role="menuitem" class="position-relative nav-item"><a href="/tag/photo/" class="NavLink nav-link">
                            Photos
                        </a></li><li role="menuitem" class="position-relative nav-item"><a href="/tag/panorama/" class="NavLink nav-link">
                            Panoramas
                        </a></li></ul> <ul class="navbar-nav justify-content-end align-items-end Header__Nav__Right"><li class="nav-item"><div class="search-box pe-4"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></li> <li class="nav-item"><a href="/rss.xml" title="Feed" class="Feed pe-4"><svg class="bi bi--size-md"><g transform="" transform-origin="center"><use xlink:href="/assets/img/bootstrap-icons.982100e4.svg#rss-fill"></use></g></svg></a></li> <li class="nav-item"><a href="https://instagram.com/dvuckovic82" target="_blank" rel="noopener noreferrer" title="Instagram" class="NavLink NavLink--External position-relative d-block pe-4"><svg class="bi bi--size-md"><g transform="" transform-origin="center"><use xlink:href="/assets/img/bootstrap-icons.982100e4.svg#instagram"></use></g></svg></a></li><li class="nav-item"><a href="https://github.com/dvuckovic" target="_blank" rel="noopener noreferrer" title="GitHub" class="NavLink NavLink--External position-relative d-block"><svg class="bi bi--size-md"><g transform="" transform-origin="center"><use xlink:href="/assets/img/bootstrap-icons.982100e4.svg#github"></use></g></svg></a></li></ul></div></div></nav> <!----></header> <article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="container-lg px-3 Post GlobalLayout"><div class="row justify-content-center"><header id="header" class="col-md-9 Post__Header"><ul itemprop="keywords" class="d-flex flex-row mb-2 list-unstyled Post__Meta Post__Meta--Tags"><li class="text-uppercase PostTag"><a href="/tag/post" class="me-3"><span>
            post
        </span></a></li><li class="text-uppercase PostTag"><a href="/tag/diy" class="me-3"><span>
            diy
        </span></a></li><li class="text-uppercase PostTag"><a href="/tag/hardware" class="me-3"><span>
            hardware
        </span></a></li><li class="text-uppercase PostTag"><a href="/tag/linux" class="me-3"><span>
            linux
        </span></a></li><li class="text-uppercase PostTag"><a href="/tag/ubuntu" class="me-3"><span>
            ubuntu
        </span></a></li></ul> <h1 itemprop="name headline" class="Post__Title">
                A DIY NAS with Ubuntu
            </h1> <p itemprop="description" class="mt-4 mb-4 Post__Summary">
                Personal experience with a NAS box based on Linux
            </p> <footer><!----> <div class="text-uppercase Post__Meta Post__Meta--Date"><time itemprop="datePublished" datetime="2010-12-24T00:00:00.000Z">
                        2010-12-24
                    </time> <span class="mx-2">
                            •
                        </span>
                        30 minutes
                    </div></footer></header></div> <div class="row"><figure class="col Post__FullImage"><img src="https://cdn.dvuckovic.com/posts/ubuntu-nas_header.jpg" alt="A DIY NAS with Ubuntu" sizes="(max-width: 800px) 400px, (max-width: 1170px) 1170px, 2000px" class="rounded w-100"></figure></div> <div class="row justify-content-center"><section itemprop="articleBody" class="col-md-9"><div class="Post__Content content__default"><p>As a personal collection of large files grows, one has always problems with additional storage. Once the problem was with not enough disk space, but today it may as well be the physical space to store the disks. A computer case is only as big, and soon you can’t add new disks, because there is simply no room in it. This is a problem I first faced a couple of years ago, and pondered ever since to solve it.</p> <h2 id="first-approach-data-tank"><a href="#first-approach-data-tank" class="Permalink">#</a> First approach (data tank)</h2> <p>At first I tried physically moving the disks in a new case, with separate power supply, and connecting it via eSATA interfaces to the main computer. Aside from a simple hack in order to turn on the power supply and disks without a dedicated motherboard, it worked pretty well. Speed was top-notch, because disks were plugged over PCI-E SATA2 controllers, and they were pretty much considered part of the machine.</p> <p>But, there was a major drawback: data was locked to the computer the data tank was attached to, and I simply wasn’t able to make the power management work with Windows OS. Disk’s were spun up all at once for the remainder of the session, and I had to manually spin them down in order to turn them off. Very complicated procedure and takes a lot of time.</p> <h2 id="contemplating-hardware"><a href="#contemplating-hardware" class="Permalink">#</a> Contemplating hardware</h2> <p>Since I bought a cheap BTX case, I couldn’t just put a computer in it, well because it was a BTX case 😉 I had an old AMD Duron based MB in storage, and was thinking of putting it in a good use. Luckily enough, it turns out BTX power supply was compatible with the old ATX board, save for one shaved off plastic hook. So, I had disks and PSU, and needed to acquire only:</p> <ul><li><p>a roomy ATX tower (turns out <a href="http://www.coolermaster.com/product.php?product_id=5239&amp;category_id=3586" target="_blank" rel="noopener noreferrer">CoolerMaster Elite 335 w/o PSU<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> was a bargain, with plenty of space in 3.5&quot; and 5.25&quot; slots)</p></li> <li><p>2 additional <a href="http://www.siliconimage.com/products/product.aspx?pid=63" target="_blank" rel="noopener noreferrer">PCI SATA controllers with 2 ports each<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (because old Duron MB didn’t have any)</p></li></ul> <p>It was a cheap &quot;upgrade&quot;, well below 100€ mark, and I was really happy about reviving an old computer which was starting to pick up dust.</p> <p><img src="https://cdn.dvuckovic.com/posts/_MG_2038.jpg" alt="Closeup of 5 1TB Samsung drives"></p> <h2 id="software"><a href="#software" class="Permalink">#</a> Software</h2> <p>There is a plenty of options for a NAS server these days (<a href="http://freenas.org/" target="_blank" rel="noopener noreferrer">FreeNAS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> being on of them), mostly based on customized Linux distributions. But I was puzzled that not a single one of them provided a GUI mode out-of-box (no X server, no Windows manager, only console mode). This was remedied mostly with Web interfaces for each service, but what if one wanted to run a program that runs only in GUI mode? There are many examples of programs running only in GUI mode (<a href="http://jdownloader.org/" target="_blank" rel="noopener noreferrer">JDownloader<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> being one of them).</p> <p>Since there is abundance of stable and reliable Linux distributions out there, I started to think if I would be able to configure one to suit my needs as a NAS. <a href="http://www.ubuntu.com/" target="_blank" rel="noopener noreferrer">Ubuntu<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> was a logical choice (Desktop Edition), since it has a massive support base, and countless boards dedicated to it.</p> <p>I didn’t wanted to reformat disks I have already filled to the brim, so they should be left as NTFS. I remembered that Linux had some problems with Microsoft’s filesystem in the past (e.g. read-only access), but was pleased to read that Ubuntu 10.10 comes with NTFS-3G installed. It is not as speedy as it could be under Windows, but it’s close, and speed won’t be an issue since I plan to hook this thing to a 100Mbit home router. And also, I had a guarantee that if the experiment with Linux collapsed, I could still access all data from a Windows box.</p> <h3 id="installing-ubuntu"><a href="#installing-ubuntu" class="Permalink">#</a> Installing Ubuntu</h3> <p>Piece of cake, but a bitter one. I managed to install Ubuntu some 5 times, before I finally realized a problem I’ve been having with freeze on login: my old Matrox AGP card was not supported. Rather than try all driver possibilities (VESA, VGA, etc), I found an old GeForce2 AGP card in my collection, swapped it, and everything went without a hitch after this. Maybe it was my error that I didn’t fully read HCL for Ubuntu 10.10 before attempting it to install on a really old piece of hardware, but I was happy that I resolved the problem quickly.</p> <p>I put the Ubuntu installation to a smaller 40 GB Maxtor Raptor 10k RPM disk, and added a 500 GB Seagate disk as a temp (for downloads, etc). My collection was, however, contained on 5 identical Samsung 1TB disks, so I needed as many SATA ports I could get. One 3114 PCI card (4 ports) and two 3112 PCI cards (2 ports) seemed enough, for this setup, at least.</p> <h3 id="setting-up-services"><a href="#setting-up-services" class="Permalink">#</a> Setting up services</h3> <p>Ubuntu comes with a plethora of services preinstalled, but I did have somewhat special case. I wanted to have a headless server (w/o direct input), to fully support Windows home network (Samba) and a liberal power management (disks standby).</p> <p>For a remote access, I enabled Remote Desktop in Ubuntu (vino based). It is accessed from System &gt; Preferences &gt; Remote Desktop menu. Vino runs on standard VNC port 5900, so it is probably good idea to forward it on the router. For VNC clients I would recommend TightVNC (Windows) and Chicken of the VNC (Mac).</p> <p>SSH is always a good thing to have. To install it simply type following command in Terminal:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>user@ubuntu:~$ <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> openssh-server
</code></pre></div><p><code>apt-get</code>is part of Advanced Packaging Tool (APT), popular packaging manager on Debian and its variants. OpenSSH implementation comes with a handy SFTP service, which is a lot like regular FTP, but is tunnelled over SSH and supports nice features such as remote copy and shell executions. SSH runs by default on port 22 (forwarded by router), and there are plenty of clients on all major OSs (putty on Windows, ssh on Mac/Linux).</p> <p>Samba is a free implementation of Windows networking under Linux, and, for a difference, it works very well. Installation is simple:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>user@ubuntu:~$ <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> samba samba-common samba-common-bin
user@ubuntu:~$ <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> system-config-samba
</code></pre></div><p>Second command installs a handy GUI configuration utility. To access it go to System &gt; Administration &gt; Samba, and you can set up shares there. I set up only one, because I intend to mount all my disks in sub-folders in it. Since Windows network works only in local, I enabled guest access, because I didn’t want to bother with entering user/pass on every single client.</p> <h3 id="managing-disks"><a href="#managing-disks" class="Permalink">#</a> Managing disks</h3> <p>In order to auto-mount disks to predefined mount points under Linux, editing of fstab is encouraged. There are two approaches in order to determine which disk to mount, and the more recent and correct way is to use UUID of the disk partition, since their <code>/dev/sd[a-z]</code> designations might change when tampered with. To obtain the list of all UUIDs on the system, use the following command:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>user@ubuntu:~$ <span class="token function">sudo</span> blkid
</code></pre></div><p>It will list all partitions and corresponding UUIDs. Copy the desired one, and then edit fstab:</p> <div class="language- extra-class"><pre class="language-text"><code>user@ubuntu:~$ sudo nano /etc/fstab
</code></pre></div><p>Each disk partition should have its own line in the configuration file in order to auto-mount it:</p> <div class="language-apacheconf extra-class"><pre class="language-apacheconf"><code>UUID=YOUR_UUID   /mount/point   &lt;filesystem_type&gt;   &lt;options&gt;   &lt;dump&gt;   &lt;pass&gt;
</code></pre></div><p>e.g.</p> <div class="language-apacheconf extra-class"><pre class="language-apacheconf"><code>UUID=6C6445206444EE80   /home/duca/Shared/1   ntfs-3g   defaults   0   0
</code></pre></div><p>Power management for disks is a little more complicated. There is a utility called <code>hdparm</code> that manages this, but I was unsuccessful at first. Commands simply failed to spin down hard disks, and finally I found out the reason. Turns out newer hard disks (especially &quot;Green&quot; ones) have embedded APM, and in order to switch the control to the OS, they should be disabled. Luckily <code>hdparm</code> has this option, with a <code>-B</code> switch:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>user@ubuntu:~$ <span class="token function">sudo</span> hdparm -B <span class="token number">255</span> /dev/sda
</code></pre></div><p>This will disable internal APM in the disk, and now you can spin down disk by using:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>user@ubuntu:~$ <span class="token function">sudo</span> hdparm -y /dev/sda
</code></pre></div><p>In order to automate these settings you can edit <code>/etc/hdparm.conf</code> file and add following for each disk:</p> <div class="language-apacheconf extra-class"><pre class="language-apacheconf"><code>/dev/sda {
    apm = 255
    poweron_standby = off
    keep_features_over_reset = on
}
</code></pre></div><p>Now that you can spin the disks down, you will want a manager that will monitor the disk activity and put them to stand by accordingly. I stumbled upon <a href="http://code.google.com/p/spindown/" target="_blank" rel="noopener noreferrer">spindown<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> project that does this very good, and it only needs to be configured right in order to work. Spindown should be installed by following its installation instructions, but first make sure you have build essentials on your box:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>user@ubuntu:~$ <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">make</span> g++ build-essential
</code></pre></div><p>Now you can download and build spindown:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>user@ubuntu:~$ <span class="token function">wget</span> http://spindown.googlecode.com/files/spindown-0.4.0.tar.gz
user@ubuntu:~$ <span class="token function">tar</span> xvzf spindown-0.4.0.tar.gz
user@ubuntu:~$ <span class="token builtin class-name">cd</span> spindown-0.4.0/
user@ubuntu:~$ <span class="token function">make</span>
user@ubuntu:~$ <span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre></div><p>To configure spindown, first copy the sample configuration to <code>/etc</code>, then list your disks by ID and then edit the conf file:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>user@ubuntu:~$ <span class="token function">cp</span> spindown.conf.example /etc/spindown.conf
user@ubuntu:~$ <span class="token function">ls</span> -l /dev/disk/by-id/
lrwxrwxrwx <span class="token number">1</span> root root  <span class="token number">9</span> <span class="token number">2010</span>-12-22 08:37 ata-ST3500320AS_9QM0BGVG -<span class="token operator">&gt;</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/sdb
user@ubuntu:~$ <span class="token function">sudo</span> <span class="token function">nano</span> /etc/spindown.conf
</code></pre></div><p>The list line contains the disk ID, and you should note it down in order to edit configuration. Each disk should have its own block in <code>.conf</code> file, following an example:</p> <div class="language-apacheconf extra-class"><pre class="language-apacheconf"><code>[Disk 1]
id = ata-ST3500320AS_9QM0BGVG
spindown = 1
command = hdparm -y
</code></pre></div><p>For the idle interval global setting should be set (<code>idle-time</code>), and then each exception changed in appropriate disk block. I set my global <code>idle-time</code> to 900 seconds (15 minutes), and then prolonged it for temp disk to 1800 seconds (30 minutes).</p> <p>You can always check the status of your disks by issuing:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>user@ubuntu:~$ <span class="token function">sudo</span> <span class="token function">service</span> spindown status
 * spindown is running
name     watched     active       idle-time        spindown-time
sda            <span class="token number">0</span>          <span class="token number">1</span>               <span class="token number">5</span>                 <span class="token number">3600</span>
sdb            <span class="token number">1</span>          <span class="token number">0</span>           <span class="token number">16547</span>                 <span class="token number">1800</span>
sde            <span class="token number">1</span>          <span class="token number">0</span>           <span class="token number">16735</span>                  <span class="token number">900</span>
sdd            <span class="token number">1</span>          <span class="token number">0</span>           <span class="token number">16735</span>                  <span class="token number">900</span>
sdg            <span class="token number">1</span>          <span class="token number">0</span>           <span class="token number">16735</span>                  <span class="token number">900</span>
sdf            <span class="token number">1</span>          <span class="token number">0</span>           <span class="token number">16734</span>                  <span class="token number">900</span>
sdc            <span class="token number">1</span>          <span class="token number">0</span>           <span class="token number">16735</span>                  <span class="token number">900</span>
</code></pre></div><p>And to check if the disk has indeed been put to standby:</p> <div class="language- extra-class"><pre class="language-text"><code>user@ubuntu:~$ sudo hdparm -C /dev/sdb
/dev/sdb:
 drive state is:  standby
</code></pre></div><h3 id="conclusion"><a href="#conclusion" class="Permalink">#</a> Conclusion</h3> <p>First, I was very impressed by the elegance of setting up a modern Linux box, chances are that if somebody already posted something that worked for them, it will work for you too. Of course, you can’t find everything you need in one place, but if you know what you are looking for, somebody probably have already figured it out.</p> <p>Second, most things work out-of-box, as expected, in contrast to other OSs where every single thing is plagued with bugs. For the first time I have a fully working Windows network, ironically set up using Linux 😄 And stability of it is just amazing: it’s been now almost a month since I set up this box, and not a single restart was needed.</p> <p><img src="https://cdn.dvuckovic.com/posts/_MG_2040.jpg" alt="System and Temp drives"></p></div></section></div> <div class="row"><section itemprop="articleBody" class="col"><div class="Post__Content content__wide"></div></section></div> <div class="Sticker d-none d-xxl-block Toc position-fixed Toc" style="opacity:0;"><div class="Toc__Item Toc__H1"><a href="#app" title="A DIY NAS with Ubuntu">
            A DIY NAS with Ubuntu
        </a></div> <div class="Toc__Item Toc__H2 Toc__Item--Active"><a href="#first-approach-data-tank" title="First approach (data tank)">
            First approach (data tank)
        </a></div><div class="Toc__Item Toc__H2"><a href="#contemplating-hardware" title="Contemplating hardware">
            Contemplating hardware
        </a></div><div class="Toc__Item Toc__H2"><a href="#software" title="Software">
            Software
        </a></div><div class="Toc__Item Toc__H3"><a href="#installing-ubuntu" title="Installing Ubuntu">
            Installing Ubuntu
        </a></div><div class="Toc__Item Toc__H3"><a href="#setting-up-services" title="Setting up services">
            Setting up services
        </a></div><div class="Toc__Item Toc__H3"><a href="#managing-disks" title="Managing disks">
            Managing disks
        </a></div><div class="Toc__Item Toc__H3"><a href="#conclusion" title="Conclusion">
            Conclusion
        </a></div></div></article> <footer class="container-fluid flex-grow-1 Footer"><div class="container-lg my-3"><div class="row align-items-center"><div class="col-lg-3 order-3 order-lg-1"><ul role="menu" class="d-flex flex-row justify-content-center justify-content-lg-start m-0 list-unstyled"><li role="menuitem" class="Footer__Nav__Item"><a href="/" class="NavLink">
                            © 2021 Dusan Vuckovic
                        </a></li></ul></div> <div class="col-lg-6 order-2 mt-1 mb-2 mb-lg-0 Footer__Center"><ul role="menu" class="d-flex flex-wrap justify-content-center m-0 list-unstyled"><li role="menuitem" class="mb-1 me-1 Footer__Nav__Item"><a href="https://vuepress.vuejs.org" target="_blank" class="NavLink NavLink--External"><img src="https://img.shields.io/badge/powered_by-VuePress-3eaf7c?logo=Vue.js" alt="Powered by VuePress"></a></li><li role="menuitem" class="mb-1 me-1 Footer__Nav__Item"><a href="https://www.cloudflare.com" target="_blank" class="NavLink NavLink--External"><img src="https://img.shields.io/badge/secured_by-Cloudflare-f38020?logo=cloudflare" alt="Secured by Cloudflare"></a></li><li role="menuitem" class="mb-1 me-1 Footer__Nav__Item"><a href="http://www.wtfpl.net" target="_blank" class="NavLink NavLink--External"><img src="https://img.shields.io/badge/license-WTFPL-white" alt="Licensed as WTFPL"></a></li></ul></div> <div class="col-lg-3 order-1 order-lg-3 mb-2 mb-lg-0"><ul role="menu" class="d-flex flex-row justify-content-center justify-content-lg-end m-0 list-unstyled"><li role="menuitem" class="Footer__Nav__Item"><a href="#email-modal" data-bs-toggle="modal" class="NavLink NavLink--External">
                            Email
                        </a></li><li role="menuitem" class="Footer__Nav__Item"><a href="/privacy-policy.html" class="NavLink">
                            Privacy
                        </a></li><li role="menuitem" class="Footer__Nav__Item"><a href="https://github.com/dvuckovic" target="_blank" class="NavLink NavLink--External">
                            Github
                        </a></li></ul></div></div></div></footer> <div id="email-modal" tabindex="-1" aria-hidden="true" class="modal fade"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h2 class="modal-title">Hey there!</h2></div> <div class="modal-body"><p>The best way to get in touch with me directly is to drop me an email.</p>
<p>My email address is my <strong>given name</strong> at this website.</p>
<p><em>If you want to send me a secure message, you can get <a href="https://cdn.dvuckovic.com/downloads/dvuckovic.crt" class="NavLink NavLink--PublicKey" download>my S/MIME certificate</a>.</em></p><p><small><em>Or, if you prefer PGP, get <a href="https://cdn.dvuckovic.com/downloads/dvuckovic.pub" class="NavLink NavLink--PublicKey" download>my public key</a>.</em></small></p></div> <div class="modal-footer"><button type="button" data-bs-dismiss="modal" class="btn btn-primary">Got it!</button></div></div></div></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7a75f1fe.js" defer></script><script src="/assets/js/19.1346b3bf.js" defer></script><script src="/assets/js/12.e1236284.js" defer></script><script src="/assets/js/39.6a747384.js" defer></script>
  </body>
</html>
